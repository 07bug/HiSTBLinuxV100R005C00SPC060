/******************************************************************************
*
* Copyright (C) 2016 Hisilicon Technologies Co., Ltd.  All rights reserved.
*
* This program is confidential and proprietary to Hisilicon  Technologies Co., Ltd. (Hisilicon),
*  and may not be copied, reproduced, modified, disclosed to others, published or used, in
* whole or in part, without the express prior written permission of Hisilicon.
*
*****************************************************************************

  File Name    : pq_hal_hdr.c
  Version       : Initial Draft
  Author        : sdk
                      sdk
  Created      : 2016/06/15
  Description  :

******************************************************************************/
#include <linux/string.h>

#include "hi_type.h"
#include "hi_math.h"

#include "pq_hal_comm.h"
#include "drv_pq_ext.h"
#include "pq_hal_hdr.h"

#define HDR_MIN(x, y) (((x) > (y)) ? (y) : (x))
#define HDR_MAX(x, y) (((x) > (y)) ? (x) : (y))
#define HDR_CLIP3(low,high,x)  (HDR_MAX(HDR_MIN((high),(x)),(low)))
typedef HI_S32 (*PF_PQ_Hal_GetHdrPathCfg) (HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg);

static HI_PQ_HDR_MODE_E aenPqHalHdrPathMode[HI_DRV_VIDEO_FRAME_TYPE_BUTT][HI_PQ_DISP_TYPE_BUTT] =
{
    {HI_PQ_HDR_MODE_SDR_TO_SDR,     HI_PQ_HDR_MODE_SDR_TO_HDR10,    HI_PQ_HDR_MODE_SDR_TO_HLG   },   /* sdr */
    {HI_PQ_HDR_MODE_SDR_TO_SDR,     HI_PQ_HDR_MODE_SDR_TO_SDR,      HI_PQ_HDR_MODE_SDR_TO_SDR   },   /* bl */   //off sdr para
    {HI_PQ_HDR_MODE_SDR_TO_SDR,     HI_PQ_HDR_MODE_SDR_TO_SDR,      HI_PQ_HDR_MODE_SDR_TO_SDR   },   /* el */   //off sdr para
    {HI_PQ_HDR_MODE_HDR10_TO_SDR,   HI_PQ_HDR_MODE_HDR10_TO_HDR10,  HI_PQ_HDR_MODE_HDR10_TO_HLG },   /* hdr10 */
    {HI_PQ_HDR_MODE_HLG_TO_SDR,     HI_PQ_HDR_MODE_HLG_TO_HDR10,    HI_PQ_HDR_MODE_HLG_TO_HLG   },   /* hlg */
    {HI_PQ_HDR_MODE_SDR_TO_SDR,     HI_PQ_HDR_MODE_SDR_TO_SDR,      HI_PQ_HDR_MODE_SDR_TO_SDR   },   /* slf */
    {HI_PQ_HDR_MODE_SDR_TO_SDR,     HI_PQ_HDR_MODE_SDR_TO_SDR,      HI_PQ_HDR_MODE_SDR_TO_SDR   },   /* tech */
};

static const HI_S32 g_au32SinTable[61] =
{
    -500, -485, -469, -454, -438, -422, -407, -391,
    -374, -358, -342, -325, -309, -292, -276, -259,
    -242, -225, -208, -191, -174, -156, -139, -122,
    -104,  -87,  -70,  -52,  -35,  -17,    0,   17,
    35,     52,   70,   87,  104,  122,  139,  156,
    174,   191,  208,  225,  242,  259,  276,  292,
    309,   325,  342,  358,  374,  391,  407,  422,
    438,   454,  469,  485,  500
};

static const HI_U32 g_au32CosTable[61] =
{
    866, 875, 883, 891, 899,  906,  914,  921,
    927, 934, 940, 946, 951,  956,  961,  966,
    970, 974, 978, 982, 985,  988,  990,  993,
    995, 996, 998, 999, 999, 1000, 1000, 1000,
    999, 999, 998, 996, 995,  993,  990,  988,
    985, 982, 978, 974, 970,  966,  961,  956,
    951, 946, 940, 934, 927,  921,  914,  906,
    899, 891, 883, 875, 866
};

static HI_PQ_HDR_CFG *pg_stPqHdrCfg     = HI_NULL;
static PQ_HDR_TM_COEF_S sg_stHdrTmClutBinOrCode;
static PQ_HDR_SM_COEF_S sg_stHdrSmClutBinOrCode;
static PQ_PARAM_S *sg_pstHdrBinPara  = HI_NULL;
static HI_PQ_HDR_MODE_E sg_enHDRMode    = HI_PQ_HDR_MODE_HDR10_TO_SDR;

static DM_INFO_S stDminfo = {0};

static HI_U32 sg_u32ToolHdrTmMode = 0;//选择HDR参数模式。0:固定参数，1:工具调试参数
static HI_U32 sg_u32ToolHdrSmMode = 0;//选择HDR参数模式。0:固定参数，1:.工具调试参数

static HI_U16 sg_au16ToolTmScale = 8;
static HI_U16 sg_au16ToolSmScale = 8;

HI_S16 g_aDstCSCTable[3][3];
HI_S16 g_as16DcOutR2Y[3] = { 64,  512,  512 };

HI_S16 g_aDstHdrOffsetCSCTable[HI_PQ_HDR_MODE_BUTT][3][3];
HI_S16 g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_BUTT][3] =
{
    { 64,  512,  512 },
    { 64,  512,  512 },
    { 64,  512,  512 },

    { 64,  512,  512 },
    { 64,  512,  512 },
    { 64,  512,  512 },

    { 64,  512,  512 },
    { 64,  512,  512 },
    { 64,  512,  512 },

    { 64,  512,  512 },
    { 64,  512,  512 },
    { 64,  512,  512 }
};

/* ------------------Y2R:YUV2RGB---------------------------- */

/* YUV to RGB params: 10bit in, 10bit out */
static const HI_U16 u16Y2RScale     = 11;    /*U4.0  [0,15] */
static const HI_U16 u16Y2RClipMin   = 0;     /* U10.0  [0,1023] */
static const HI_U16 u16Y2RClipMax   = 4095;  /* U10.0  [0,1023] */

static const HI_S16 as16Y2RDcInLimit[3] =       /* S10.0  [-1024, 1023] */
{
    -64,
    -512,
    -512
};

static const HI_S16 as16Y2RDcInFull[3] =
{
    0,
    -512,
    -512
};

static const HI_S16 as16Y2RM33_601L[3][3] =
{
    {9567 , 0      ,  13113} ,
    {9567 , -3219 ,  -6679},
    {9567 , 16557 ,  0    }
};

static const HI_S16 as16Y2RM33_601F[3][3] =
{
    {8192 ,  0      ,   11485} ,
    {8192 ,  -2819  ,  -5850 },
    {8192 , 14501  ,    0   }
};

static const HI_S16 as16Y2RM33_709L[3][3] =
{
    {9567,           0,       14729},
    {9567,       -1752,       -4379},
    {9567,       17356,           0}
};

static const HI_S16 as16Y2RM33_709F[3][3] =
{
    {8192,           0 ,      12901},
    {8192,       -1535 ,      -3835},
    {8192 ,       15201 ,          0}
};

static const HI_S16 as16Y2RM33_2020L[3][3] =
{
    {9567,           0 ,      13792},
    {9567,       -1539 ,      -5344},
    {9567 ,       17597,           0}
};

static const HI_S16 as16Y2RM33_2020F[3][3] =
{
    {8192,           0 ,      12080},
    {8192 ,      -1348  ,     -4681},
    {8192 ,      15412 ,          0}
};

static const HI_S16 as16Y2RDcOut[3] =      /*  S10.0 [-1024, 1023] */
{
    0,
    0,
    0
};

/* ---------------------------------------------- */

/************* DeGamma Params **************/
static const HI_U32 au32DeGmm_step[PQ_DEGMM_SEG_SIZE] =
{
    1, 2, 3, 4, 5, 6, 7, 8
};          /*U4.0  [0,15] */

static const HI_U32 au32DeGmm_pos[PQ_DEGMM_SEG_SIZE]  =
{
    4, 16, 32, 128, 256, 2560, 3584, 4095
};/*U10.0 [0,1023] */

static const HI_U32 au32DeGmm_num[PQ_DEGMM_SEG_SIZE]  =
{
    2, 5, 7, 13, 17, 53, 61, 63
};        /*U6.0  [0,63] */

// DePQ curve: MPEG HDR
static const HI_U32 au32DeGmmLut_PQ[PQ_DEGMM_LUT_SIZE] =                           //U21.0 [0,2097151]
{
    0 ,         0 ,         0 ,         0 ,         0 ,         0 ,         0 ,         0 ,
    1 ,         1 ,         2 ,         2 ,         3 ,         5 ,         7 ,        11 ,
    15 ,        21 ,        36 ,        58 ,        86 ,       125 ,       174 ,       237 ,
    316 ,       415 ,       536 ,       684 ,       865 ,      1082 ,      1343 ,      1654 ,
    2025 ,      2465 ,      2984 ,      3596 ,      4315 ,      5157 ,      6143 ,      7294 ,
    8634 ,     10194 ,     12007 ,     14110 ,     16547 ,     19369 ,     22633 ,     26406 ,
    30763 ,     35793 ,     41596 ,     48288 ,     56002 ,     64892 ,     86935 ,    116188 ,
    155014 ,    206576 ,    275129 ,    366417 ,    488226 ,    651170 ,   1164118 ,   2097151 ,
};

// DeHLG Curve: BBC HDR
static const HI_U32 au32DeGmmLut_HLG[PQ_DEGMM_LUT_SIZE] =                              //U21.0 [0,2097151]
{
    0 ,         0 ,         1 ,         3 ,         6 ,        11 ,        24 ,        43 ,
    96 ,       171 ,       267 ,       384 ,       523 ,       683 ,      1067 ,      1537 ,
    2092 ,      2732 ,      4269 ,      6147 ,      8367 ,     10928 ,     13831 ,     17075 ,
    20661 ,     24588 ,     28857 ,     33467 ,     38419 ,     43712 ,     49347 ,     55323 ,
    61641 ,     68300 ,     75301 ,     82643 ,     90327 ,     98352 ,    106719 ,    115427 ,
    124477 ,    133868 ,    143601 ,    153675 ,    164091 ,    174848 ,    186273 ,    198741 ,
    212348 ,    227197 ,    243403 ,    261088 ,    280389 ,    301452 ,    349526 ,    406781 ,
    474971 ,    556185 ,    652910 ,    768109 ,    905311 ,   1068716 ,   1495116 ,   2097151 ,
};

static const HI_U32 au32DeGmmLut_SLF[PQ_DEGMM_LUT_SIZE] =                               //U21.0 [0,2097151]
{
    0 ,         0 ,         0 ,         0 ,         0 ,         0 ,         0 ,         0 ,
    0 ,         0 ,         0 ,         1 ,         1 ,         1 ,         1 ,         1 ,
    2 ,         3 ,         5 ,         8 ,        13 ,        21 ,        32 ,        48 ,
    70 ,       101 ,       143 ,       199 ,       273 ,       369 ,       493 ,       651 ,
    851 ,      1102 ,      1414 ,      1800 ,      2273 ,      2849 ,      3547 ,      4387 ,
    5394 ,      6595 ,      8021 ,      9706 ,     11690 ,     14017 ,     16736 ,     19905 ,
    23586 ,     27850 ,     32778 ,     38460 ,     44999 ,     52511 ,     70999 ,     95219 ,
    126885 ,    168308 ,    222692 ,    294624 ,    390928 ,    522269 ,    974953 ,   2097151 ,
};

// DeGamma Curve: SDR
static const HI_U32 au32DeGmmLut_24[PQ_DEGMM_LUT_SIZE] =                            //U21.0 [0,2097151]
{
    0 ,         0 ,         0 ,         1 ,         2 ,         3 ,         9 ,        18 ,
    49 ,        97 ,       166 ,       257 ,       372 ,       512 ,       875 ,      1356 ,
    1963 ,      2704 ,      4619 ,      7155 ,     10358 ,     14271 ,     18934 ,     24381 ,
    30647 ,     37765 ,     45763 ,     54671 ,     64517 ,     75325 ,     87122 ,     99932 ,
    113779 ,    128684 ,    144670 ,    161758 ,    179970 ,    199324 ,    219841 ,    241540 ,
    264439 ,    288557 ,    313912 ,    340521 ,    368401 ,    397569 ,    428041 ,    459835 ,
    492964 ,    527446 ,    563296 ,    600527 ,    639157 ,    679198 ,    763573 ,    853766 ,
    949885 ,   1052038 ,   1160327 ,   1274854 ,   1395717 ,   1523013 ,   1797278 ,   2097151 ,
};

static const HI_U32 au32DeGmmLut_22[PQ_DEGMM_LUT_SIZE] =                            //U21.0 [0,2097151]
{
    0 ,         0 ,         1 ,         2 ,         6 ,        11 ,        26 ,        49 ,
    118 ,       223 ,       364 ,       544 ,       764 ,      1025 ,      1674 ,      2500 ,
    3509 ,      4708 ,      7691 ,     11487 ,     16124 ,     21630 ,     28029 ,     35340 ,
    43584 ,     52780 ,     62942 ,     74088 ,     86232 ,     99387 ,    113568 ,    128785 ,
    145052 ,    162380 ,    180780 ,    200261 ,    220835 ,    242511 ,    265299 ,    289207 ,
    314244 ,    340420 ,    367742 ,    396218 ,    425856 ,    456664 ,    488650 ,    521820 ,
    556182 ,    591742 ,    628508 ,    666486 ,    705682 ,    746103 ,    830645 ,    920159 ,
    1014692 ,   1114289 ,   1218993 ,   1328845 ,   1443887 ,   1564158 ,   1820538 ,   2097151 ,
};

/* ------------------ToneMapping---------------------------- */

/* ToneMapping Tmap Params: 20bit in, 20bit out */
static const HI_U16 u16TmScaleLumaCal       = 15;                   /* U4.0  [0,15] */
static const HI_U16 au16TmM3LumaCal_2020[3] = {8608, 22217, 1943};  /* U1.15 [0, 65535]     {0.2627, 0.6780, 0.0593}<<u16TmScaleLumaCal */
static const HI_U16 au16TmM3LumaCal_709[3]  = {6970, 23432, 2366};  /* U1.15 [0, 65535]      */
static const HI_U16 au16TmM3LumaCal_601[3]  = {9798, 19235, 3736};  // U1.15 [0, 65535]

static const HI_U16 u16ScaleCoefTM       = 7;                    /*  U4.0  [0,15] */
static const HI_U32 u32TmClipMin         = 0;                    /*  U21.0  [0,2097152] */
static const HI_U32 u32TmClipMax         = 2097151;              /*  U21.0  [0,2097152] */

/* ToneMapping Smap Params: 20bit in, 20bit out */
static const HI_U16 u16SmapScaleCoef         = 8;                    /*  U4.0  [0,15] */

/* GamutMapping Params: 20bit in, 20bit out  */
static const HI_U32 u32GMapClipMin  = 0;            /*   U20.0 [0,1048575] */
static const HI_U32 u32GMapClipMax  = 2097151;      //U21.0 [0,2097151]
static const HI_U16 u16GMapScale    = 14;           /*  U4.0  [0,15] */
static const HI_S16 as16M33GMap_2020to709[3][3] =   /*  S1.14 [-2^15, 2^15-1] = [-32768, 32767] */
{
    /* 2020 to 709 */
    {27209 ,      -9632  ,     -1194 },
    { -2045 ,      18565  ,      -138 },
    { -297  ,     -1648   ,    18330     }
};

static const HI_S16 as16M33GMap_709to2020[3][3] =               /*   S1.14 [-2^15, 2^15-1] = [-32768, 32767]  */
{
    /* 709 to 2020  */
    {10279 ,       5396  ,       710},
    {1134  ,     15064   ,      187 },
    {268   ,     1442    ,   14673  }
};

static const HI_S16 as16M33GMap_linear[3][3] =                  /*  S1.14 [-2^15, 2^15-1] = [-32768, 32767] */
{
    /* Linear */
    { 16384,       0  ,       0 },
    {     0,     16384,       0 },
    {     0,       0  ,   16384 }
};

static const HI_S16 as16M33GMAP_Pal_601_709[3][3] =
{
    //BT601 to BT709
    {17106  ,      -724      ,    -1 },
    { -2   ,    16386    ,       0 },
    { 1    ,    193     ,  16191  }
};

static const HI_S16 as16M33GMAP_Pal_601_2020[3][3] =
{
    //BT601 to BT2020
    { 10731 ,       4951   ,      701 },
    { 1182  ,     15018   ,      184 },
    {  280   ,     1603   ,   14500  }
};

/*************** ToneMapping Lut Params:  *******************************/
static const HI_U32 au32TMapStep[PQ_TMAP_SEG_SIZE] =        /* U5.0  [0,20] */
{
    5, 7, 9, 10, 11, 13, 15, 17
};

static const HI_U32 au32TMapPos[PQ_TMAP_SEG_SIZE]  =        /* U20.0 [0,1048575] */
{
    128, 1024, 2048, 6144, 16384, 131072, 655360, 2097151
};

static const HI_U32 au32TMapNum[PQ_TMAP_SEG_SIZE]  =        /* U6.0  [0,63] */
{
    4, 11, 13, 17, 22, 36, 52, 63
};

/*************** ToneMapping Smap Lut Params:  *******************************/
static const HI_U32 au32SMapStep[PQ_SMAP_SEG_SIZE] =        /* U5.0  [0,21] */
{
    5,  7,  9,  10,  11, 13, 15, 17
};

static const HI_U32 au32SMapPos[PQ_SMAP_SEG_SIZE]  =        /* U21.0 [0,1048575] */
{
    128, 1024,    2048,   6144,   16384,   131072,  655360, 2097151
};

static const HI_U32 au32SMapNum[PQ_SMAP_SEG_SIZE]  =        /* U6.0  [0,63] */
{
    4,  11, 13, 17, 22, 36, 52, 63
};

/* ToneMapping Lut: HDR10  to SDR */
static const HI_U16 u16ScaleCoefTM_HDR2SDR   = 8;         /* U4.0  [0,15] */

// ToneMapping Lut: SLF to SDR
static const HI_U16 u16ScaleCoefTM_SLF2SDR = 7;        // U4.0  [0,15]
static const HI_U32 au32TMLut_SLF2SDR[PQ_TMAP_LUT_SIZE] =
{
    //U9.7 [0,65535]
    2748     ,    2748     ,    2741     ,    2801     ,    2781     ,    2803     ,    2807     ,    2798     ,
    2802     ,    2803     ,    2797     ,    2797     ,    2792     ,    2787     ,    2772     ,    2760     ,
    2747     ,    2733     ,    2707     ,    2681     ,    2656     ,    2631     ,    2606     ,    2509     ,
    2417     ,    2330     ,    2247     ,    2168     ,    2093     ,    2021     ,    1953     ,    1888     ,
    1827     ,    1768     ,    1711     ,    1658     ,    1607     ,    1424     ,    1271     ,    1142     ,
    1033     ,    940      ,    861      ,    792      ,    733      ,    681      ,    635      ,    595      ,
    559      ,    527      ,    498      ,    472      ,    449      ,    375      ,    321      ,    281      ,
    250      ,    225      ,    204      ,    187      ,    173      ,    160      ,    150      ,    140      ,
};

/*************** ToneMapping Lut Params:  *******************************/
static HI_U32 au32TMLut_HDR2SDR_Vivid[PQ_TMAP_LUT_SIZE] =             /* U9.7 [0,65535] */
{
    5000,    5000,    7000,    9000,    10568,    10091,    9768 ,    9531 ,
    9348 ,    9200 ,    9078 ,    8974 ,    8675 ,    8478 ,    8220 ,    8045 ,
    7912 ,    7801 ,    7619 ,    7467 ,    7332 ,    7209 ,    7093 ,    6680 ,
    6317 ,    5988 ,    5686 ,    5407 ,    5149 ,    4909 ,    4685 ,    4477 ,
    4282 ,    4099 ,    3929 ,    3769 ,    3619 ,    3104 ,    2698 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560
};

static HI_U32 au32TMLut_HDR2SDR_b100[PQ_TMAP_LUT_SIZE] =             /* U9.7 [0,65535] */
{
    5000,    5000,    7000,    9000,    10568,    10091,    9768 ,    9531 ,
    9348 ,    9200 ,    9078 ,    8974 ,    8675 ,    8478 ,    8220 ,    8045 ,
    7912 ,    7801 ,    7619 ,    7467 ,    7332 ,    7209 ,    7093 ,    6680 ,
    6317 ,    5988 ,    5686 ,    5407 ,    5149 ,    4909 ,    4685 ,    4477 ,
    4282 ,    4099 ,    3929 ,    3769 ,    3619 ,    3104 ,    2698 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560
};

static HI_U32 au32TMLut_HDR2SDR_b0[PQ_TMAP_LUT_SIZE] =             /* U9.7 [0,65535] */
{
    5000,    5000,    7000,    9000,    10568,    10091,    9768 ,    9531 ,
    9348 ,    9200 ,    9078 ,    8974 ,    8675 ,    8478 ,    8220 ,    8045 ,
    7912 ,    7801 ,    7619 ,    7467 ,    7332 ,    7209 ,    7093 ,    6680 ,
    6317 ,    5988 ,    5686 ,    5407 ,    5149 ,    4909 ,    4685 ,    4477 ,
    4282 ,    4099 ,    3929 ,    3769 ,    3619 ,    3104 ,    2698 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560
};

static HI_U32 au32TMLut_HDR2SDR_d100[PQ_TMAP_LUT_SIZE] =             /* U9.7 [0,65535] */
{
    5000,    5000,    7000,    9000,    10568,    10091,    9768 ,    9531 ,
    9348 ,    9200 ,    9078 ,    8974 ,    8675 ,    8478 ,    8220 ,    8045 ,
    7912 ,    7801 ,    7619 ,    7467 ,    7332 ,    7209 ,    7093 ,    6680 ,
    6317 ,    5988 ,    5686 ,    5407 ,    5149 ,    4909 ,    4685 ,    4477 ,
    4282 ,    4099 ,    3929 ,    3769 ,    3619 ,    3104 ,    2698 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560
};

static HI_U32 au32TMLut_HDR2SDR_d0[PQ_TMAP_LUT_SIZE] =             /* U9.7 [0,65535] */
{
    5000,    5000,    7000,    9000,    10568,    10091,    9768 ,    9531 ,
    9348 ,    9200 ,    9078 ,    8974 ,    8675 ,    8478 ,    8220 ,    8045 ,
    7912 ,    7801 ,    7619 ,    7467 ,    7332 ,    7209 ,    7093 ,    6680 ,
    6317 ,    5988 ,    5686 ,    5407 ,    5149 ,    4909 ,    4685 ,    4477 ,
    4282 ,    4099 ,    3929 ,    3769 ,    3619 ,    3104 ,    2698 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560
};

static HI_U32 au32TMLut_HDR2SDR_BP[PQ_TMAP_LUT_SIZE] =             /* U9.7 [0,65535] */
{
    5000,  5000,  7000,  9000, 10568, 10091,  9768,  9531,
    9348,  9200,  9078,  8974,  8675,  8478,  8220,  8045,
    7912,  7801,  7619,  7467,  7332,  7209,  7093,  6680,
    6317,  5988,  5686,  5407,  5149,  4909,  4685,  4477,
    4282,  4099,  3929,  3769,  3619,  3104,  2698,  2560,
    2560,  2560,  2560,  2560,  2560,  2560,  2560,  2560,
    2560,  2560,  2560,  2560,  2560,  2560,  2560,  2560,
    2560,  2560,  2560,  2560,  2560,  2560,  2560,  2560,
};

static HI_U32 au32TMLut_HDR2SDR_DP[PQ_TMAP_LUT_SIZE] =             /* U9.7 [0,65535] */
{
    5000,  5000,  7000,  9000, 10568, 10091,  9768,  9531,
    9348,  9200,  9078,  8974,  8675,  8478,  8220,  8045,
    7912,  7801,  7619,  7467,  7332,  7209,  7093,  6680,
    6317,  5988,  5686,  5407,  5149,  4909,  4685,  4477,
    4282,  4099,  3929,  3769,  3619,  3104,  2698,  2560,
    2560,  2560,  2560,  2560,  2560,  2560,  2560,  2560,
    2560,  2560,  2560,  2560,  2560,  2560,  2560,  2560,
    2560,  2560,  2560,  2560,  2560,  2560,  2560,  2560,
};

/* ToneMapping Lut: SDR to HDR10 */
static const HI_U16 u16ScaleCoefTM_SDR2HDR = 15;         /* U4.0  [0,15] */
static const HI_U32 au32TMLut_SDR2HDR[PQ_TMAP_LUT_SIZE] =                   //U1.15 [0,65535]
{
    10820, 10820,  5410,  3743,  4522,  6551,  6799,  6947,
    6926,  6905,  6889,  6853,  6774,  6714,  6604,  6510,
    6474,  6434,  6354,  6285,  6236,  6201,  6175,  6092,
    6070,  6040,  6019,  6024,  6030,  6038,  6047,  6056,
    6064,  6093,  6105,  6131,  6159,  6248,  6370,  6475,
    6600,  6745,  6877,  7033,  7176,  7338,  7508,  7668,
    7855,  8037,  8212,  8418,  8610,  9475, 10474, 11620,
    12945, 14521, 16321, 18500, 21081, 24253, 28346, 32733,
};

/* ToneMapping Lut: SDR to HLG */
static const HI_U16 u16ScaleCoefTM_SDR2HLG1000 = 12;         /* U4.0  [0,15] */
static const HI_U32 au32TMLut_SDR2HLG1000[PQ_TMAP_LUT_SIZE] =                   //U1.15 [0,65535]
{
    // U8.8 [0,65535]
    10017 ,     10017 ,      5085 ,      3538 ,      4003 ,      4807 ,     4634 ,      4497 ,
    4322 ,      4182 ,      4068 ,      3961 ,      3667 ,      3470 ,      3199 ,      3013 ,
    2890 ,      2789 ,      2631 ,      2512 ,      2421 ,      2348 ,      2288 ,      2115 ,
    2010 ,      1929 ,      1865 ,      1819 ,      1781 ,      1748 ,      1720 ,      1695 ,
    1672 ,      1657 ,      1639 ,      1626 ,      1615 ,      1574 ,      1552 ,      1533 ,
    1524 ,      1522 ,      1519 ,      1524 ,      1527 ,      1535 ,      1546 ,      1555 ,
    1570 ,      1584 ,      1597 ,      1616 ,      1632 ,      1715 ,      1817 ,      1938 ,
    2079 ,      2248 ,      2439 ,      2669 ,      2936 ,      3259 ,      3669 ,      4092 ,
};

/* ToneMapping Smap Lut: SLF  to HDR10 */
static const HI_U32 au32SMLutLinear[PQ_SMAP_LUT_SIZE] =                  //U2.8 [0,1023]
{
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
};

/* ToneMapping Smap Lut: SLF  to SDR */
static const HI_U32 au32SMLut_SLF2SDR[PQ_SMAP_LUT_SIZE] =                    //U2.8 [0,1023]
{
    248,   248,   248,   248,   248,   248,   248,   248,
    248,   248,   248,   248,   248,   248,   248,   248,
    248,   248,   248,   248,   248,   248,   248,   248,
    248,   248,   248,   248,   248,   248,   248,   240,
    234,   230,   226,   222,   218,   214,   205,   199,
    194,   191,   188,   185,   183,   181,   179,   177,
    175,   173,   172,   170,   165,   159,   155,   151,
    147,   143,   140,   137,   134,   131,   128,   126,
};

/* ToneMapping Smap Lut: SDR  to HDR */
static const HI_U32 au32SMLut_SDR2HDR[PQ_SMAP_LUT_SIZE] =
{
    //U2.8 [0,1023]
    333,   333,   333,   333,   333,   333,   333,   333,
    333,   333,   333,   333,   333,   333,   333,   333,
    333,   333,   333,   333,   333,   333,   333,   333,
    333,   333,   333,   333,   333,   333,   333,   333,
    333,   333,   333,   333,   333,   333,   333,   333,
    333,   333,   333,   333,   333,   333,   333,   333,
    333,   333,   333,   333,   333,   333,   333,   333,
    333,   333,   333,   333,   333,   333,   333,   333,
};

/* ToneMapping Smap Lut: HDR10  to SDR */
static const HI_U16 u16ScaleCoefSM = 8;         /* U4.0  [0,15] */
static const HI_U32 au32SMLut_HDR2SDR[PQ_SMAP_LUT_SIZE] =            //U2.8 [0,1023]
{
    248,   248,   248,   248,   248,   248,   248,   248,
    248,   248,   248,   248,   248,   248,   248,   248,
    248,   248,   248,   248,   248,   248,   248,   248,
    248,   248,   248,   248,   248,   248,   248,   240,
    234,   230,   226,   222,   218,   214,   205,   199,
    194,   191,   188,   185,   183,   181,   179,   177,
    175,   173,   172,   170,   165,   159,   155,   151,
    147,   143,   140,   137,   134,   131,   128,   126,
};

/* ToneMapping Lut: HDR10 to BBC */
static const HI_U16 u16ScaleCoefTM_HDR2HLG = 8;        /* U4.0  [0,15] */
static const HI_U32 au32TMLut_HDR2HLG[PQ_TMAP_LUT_SIZE] =              /*U6.10 [0,65535] */
{
    //U1.15 [0,65535]
    11074 ,     11074 ,     9866 ,      9221 ,      8790 ,      7831 ,      7319 ,      6976 ,
    6722 ,      6521 ,      6355 ,      6215 ,      5809 ,      5537 ,      5175 ,      4933 ,
    4753 ,      4611 ,      4395 ,      4234 ,      4108 ,      4004 ,      3915 ,      3660 ,
    3488 ,      3361 ,      3260 ,      3178 ,      3108 ,      3047 ,      2994 ,      2947 ,
    2905 ,      2866 ,      2831 ,      2799 ,      2769 ,      2668 ,      2588 ,      2341 ,
    2048 ,      1820 ,      1638 ,      1489 ,      1365 ,      1260 ,      1170 ,      1092 ,
    1024 ,      964 ,       910 ,       862 ,       819 ,       683 ,       585 ,       512 ,
    455 ,       410 ,       372 ,       341 ,       315 ,       293 ,       273 ,       256 ,
};

static const HI_U16 u16ScaleCoefTM_HLG2HDR = 15;  // U4.0  [0,15]
static const HI_U32 au32TMLut_HLG2HDR[PQ_TMAP_LUT_SIZE] =     //U1.15 [0,65535]
{
    2853,  2853,  3277,  3554,  3764,  4324,  4689,  4967,
    5193,  5386,  5555,  5705,  6187,  6554,  7107,  7528,
    7872,  8164,  8648,  9042,  9378,  9672,  9933, 10773,
    11411, 11931, 12374, 12762, 13107, 13420, 13705, 13969,
    14214, 14444, 14659, 14863, 15056, 15743, 16328, 16839,
    17295, 17707, 18084, 18432, 18756, 19059, 19343, 19612,
    19867, 20109, 20340, 20562, 20774, 21545, 22220, 22821,
    23365, 23863, 24322, 24749, 25148, 25524, 25878, 26214,
};

/* ToneMapping Smap Lut: BBC to HDR10 */
static const HI_U16 u16ScaleCoefSM_HLG2HDR = 8;           /* U4.0  [0,15] */
static const HI_U32 au32SMLut_HLG2HDR[PQ_SMAP_LUT_SIZE] =                /*U1.15 [0,65535] */
{
    /*PQ1250*/
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
};

/* ToneMapping Lut: HLG to SDR */
static const HI_U16 u16ScaleCoefTM_HLG2SDR = 12;          /* U4.0  [0,15] */
static const HI_U32 au32TMLut_HLG2SDR[PQ_TMAP_LUT_SIZE] =
{
    13079 ,     13079 ,      7301 ,      5383 ,      4443 ,      3110 ,      2728 ,      2570 ,
    2497 ,      2464 ,      2451 ,      2450 ,      2494 ,      2562 ,      2697 ,      2816 ,
    2920 ,      3012 ,      3170 ,      3301 ,      3414 ,      3514 ,      3604 ,      3891 ,
    4108 ,      4283 ,      4431 ,      4558 ,      4670 ,      4769 ,      4858 ,      4939 ,
    5013 ,      5080 ,      5142 ,      5200 ,      5253 ,      5433 ,      5571 ,      5679 ,
    5764 ,      5829 ,      5880 ,      5919 ,      5946 ,      5965 ,      5975 ,      5979 ,
    5977 ,      5969 ,      5957 ,      5941 ,      5921 ,      5813 ,      5670 ,      5507 ,
    5332 ,      5150 ,      4966 ,      4784 ,      4604 ,      4429 ,      4259 ,      4096 ,
};

/* ToneMapping Smap Lut: HLG to SDR */
static const HI_U16 u16ScaleCoefSM_HLG2SDR = 8;//12;          /* U4.0  [0,15] */
static const HI_U32 au32SMLut_HLG2SDR[PQ_SMAP_LUT_SIZE] =
{
    218,   218,   218,   218,   218,   218,   218,   218,
    218,   218,   218,   218,   218,   218,   218,   218,
    218,   218,   218,   218,   218,   218,   218,   218,
    218,   218,   218,   218,   218,   218,   218,   218,
    218,   218,   208,   205,   201,   199,   185,   165,
    125,    95,    60,    40,    40,    40,    40,    40,
    40,    40,    40,    30,    30,    30,    30,    30,
    20,    20,    20,    20,    20,    20,    10,    10,
};

/* ToneMapping Lut: AVS to HDR10 */
static const HI_U16 u16ScaleCoefTM_Linear = 8;             /* U4.0  [0,15] */
static const HI_U32 au32TMLut_Linear[PQ_TMAP_LUT_SIZE] =                 /* U8.8 [0,65535] */
{
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
    256,   256,   256,   256,   256,   256,   256,   256,
};

/* ---------------------------------------------- */

/******************* Gmm-8 Lut Params *************************/
static const HI_U32 au32GmmStep[PQ_GMM_SEG_SIZE] =        //U5.0  [0,21]
{
    3,  5,  7,  9,  11, 12, 15, 17
};

static const HI_U32 au32GmmPos[PQ_GMM_SEG_SIZE]  =        //U21.0 [0,2097151]
{
    32, 128,    1024,   2048,   8192,   65536,  655360, 2097151
};

static const HI_U32 au32GmmNum[PQ_GMM_SEG_SIZE]  =        //U6.0  [0,63]
{
    4,  7,  14, 16, 19, 33, 51, 62
};

// PQ Curve

static const HI_U32 au32GmmLut_PQ10000[PQ_GMM_LUT_SIZE] =              //U12.0 [0,4095]
{
    0 ,       167 ,       227 ,       270 ,       304 ,       400 ,       466 ,       517 ,
    657 ,       750 ,       820 ,       878 ,       927 ,       970 ,      1008 ,      1129 ,
    1220 ,      1454 ,      1600 ,      1708 ,      1866 ,      1980 ,      2071 ,      2147 ,
    2211 ,      2267 ,      2317 ,      2362 ,      2403 ,      2440 ,      2475 ,      2507 ,
    2537 ,      2565 ,      2743 ,      2870 ,      2969 ,      3051 ,      3120 ,      3179 ,
    3232 ,      3279 ,      3321 ,      3360 ,      3396 ,      3429 ,      3460 ,      3489 ,
    3516 ,      3541 ,      3565 ,      3588 ,      3668 ,      3736 ,      3795 ,      3847 ,
    3893 ,      3934 ,      3972 ,      4007 ,      4039 ,      4068 ,      4095 ,      4095 ,

} ;

static const HI_U32 au32GmmLut_PQ1250[PQ_GMM_LUT_SIZE] =              //U12.0 [0,4095]
{
    0       , 0      , 60     , 86     , 105    , 157    , 193    , 221    ,
    300     , 355    , 398    , 433    , 464    , 491    , 516    , 595    ,
    656     , 820    , 927    , 1008   , 1129   , 1220   , 1293   , 1354   ,
    1407    , 1454   , 1496   , 1534   , 1568   , 1600   , 1630   , 1658   ,
    1684    , 1708   , 1866   , 1980   , 2071   , 2147   , 2211   , 2267   ,
    2317    , 2362   , 2403   , 2440   , 2475   , 2507   , 2537   , 2565   ,
    2591    , 2616   , 2640   , 2663   , 2743   , 2811   , 2870   , 2922   ,
    2969    , 3012   , 3051   , 3086   , 3120   , 3150   , 3179   , 3179
} ;

static const HI_U32 au32GmmLut_PQ1000[PQ_GMM_LUT_SIZE] =              //U12.0 [0,4095]
{
    0 ,        54 ,        77 ,        94 ,       108 ,       151 ,       182 ,       206 ,
    278 ,       328 ,       367 ,       400 ,       429 ,       454 ,       477 ,       552 ,
    609 ,       765 ,       868 ,       945 ,      1062 ,      1149 ,      1220 ,      1279 ,
    1331 ,      1376 ,      1417 ,      1454 ,      1488 ,      1519 ,      1548 ,      1575 ,
    1600 ,      1624 ,      1778 ,      1891 ,      1980 ,      2055 ,      2118 ,      2173 ,
    2223 ,      2267 ,      2308 ,      2345 ,      2379 ,      2411 ,      2440 ,      2468 ,
    2494 ,      2519 ,      2543 ,      2565 ,      2645 ,      2712 ,      2771 ,      2823 ,
    2870 ,      2912 ,      2951 ,      2987 ,      3020 ,      3051 ,      3079 ,      3079 ,
} ;

//HLG Curve
static const HI_U32 au32GmmLut_HLG[PQ_GMM_LUT_SIZE] =              //U12.0 [0,4095]
{
    0 ,        14 ,        20 ,        24 ,        28 ,        39 ,        48 ,        55 ,
    78 ,        96 ,       111 ,       124 ,       136 ,       147 ,       157 ,       192 ,
    222 ,       314 ,       384 ,       443 ,       543 ,       627 ,       701 ,       768 ,
    830 ,       887 ,       941 ,       991 ,      1040 ,      1086 ,      1130 ,      1173 ,
    1214 ,      1254 ,      1536 ,      1774 ,      1983 ,      2166 ,      2314 ,      2436 ,
    2541 ,      2633 ,      2715 ,      2788 ,      2855 ,      2916 ,      2973 ,      3025 ,
    3074 ,      3120 ,      3163 ,      3204 ,      3347 ,      3467 ,      3570 ,      3661 ,
    3741 ,      3813 ,      3879 ,      3940 ,      3996 ,      4048 ,      4095 ,      4095 ,
};

// Gamma Curve
static const HI_U32 au32GmmLut_22[PQ_GMM_LUT_SIZE] =              //U12.0 [0,4095]
{
    0 ,        14 ,        19 ,        23 ,        26 ,        36 ,        44 ,        50 ,
    68 ,        82 ,        93 ,       103 ,       112 ,       120 ,       128 ,       154 ,
    175 ,       240 ,       289 ,       329 ,       396 ,       451 ,       500 ,       543 ,
    582 ,       619 ,       653 ,       685 ,       715 ,       744 ,       771 ,       798 ,
    823 ,       848 ,      1019 ,      1162 ,      1286 ,      1397 ,      1498 ,      1592 ,
    1679 ,      1762 ,      1840 ,      1914 ,      1985 ,      2053 ,      2118 ,      2181 ,
    2242 ,      2301 ,      2358 ,      2414 ,      2623 ,      2813 ,      2989 ,      3153 ,
    3308 ,      3455 ,      3594 ,      3727 ,      3855 ,      3978 ,      4095 ,      4095 ,
};

/* RGB to YUV Params */
/* --------------R2Y:RGB2YUV-------------------------------- */

static const HI_U16 u16ScaleR2Y         = 14;   /* U4.0  [0,15] */
static const HI_U16 u16ClipMinRF2YL_Y   = 64;   /* U10.0  [0,1023] */
static const HI_U16 u16ClipMaxRF2YL_Y   = 940;  /* U10.0  [0,1023] */
static const HI_U16 u16ClipMinRF2YL_UV  = 64;   /* U10.0  [0,1023] */
static const HI_U16 u16ClipMaxRF2YL_UV  = 960;  /* U10.0  [0,1023] */

static const HI_U16 u16ClipMinRF2YF_Y   = 0;    // U10.0  [0,1023]
static const HI_U16 u16ClipMaxRF2YF_Y   = 1023; // U10.0  [0,1023]
static const HI_U16 u16ClipMinRF2YF_UV  = 0;    // U10.0  [0,1023]
static const HI_U16 u16ClipMaxRF2YF_UV  = 1023; // U10.0  [0,1023]

static const HI_S16 as16DcInRF2YL[3] =                            /* S10.0  [-1024, 1023] */
{
    0,
    0,
    0
};

static const  HI_S16 as16DcInRF2YF[3] =      // S10.0  [-1024, 1023]
{
    0,
    0,
    0
};

static HI_S16 as16M33RF2YL_709[3][3] =      // S1.14 [-32768, 32767]
{
    //BT709
    {2984  ,     10034   ,     1013  },
    { -1643 ,      -5531  ,      7175 },
    {7175  ,     -6518   ,     -659  }
};

static const HI_S16 as16M33RF2YL_2020NCL[3][3] =      // S1.14 [-32768, 32767]
{
    //BT2020
    {3685  ,      9512  ,       832  },
    { -2004 ,      -5171 ,       7175 },
    {7175  ,     -6598  ,      -577  }
};

static const HI_S16 as16M33RF2YL_601[3][3] =      // S1.14 [-32768, 32767]
{
    //BT601
    {4195    ,    8235   ,     1599  },
    { -2421 ,      -4754  ,      7175 },
    {7175   ,    -6004    ,   -1167  }
};

static const HI_S16  as16M33RF2YF_709[3][3] =      // S1.14 [-32768, 32767]
{
    //BT709
    {3483    ,   11718     ,   1183  },
    { -1877  ,     -6315   ,     8192 },
    { 8192   ,    -7441    ,    -751  }
};

static const HI_S16  as16M33RF2YF_2020NCL[3][3] =      // S1.14 [-32768, 32767]
{
    //BT2020
    { 4304   ,    11108    ,     972  },
    { -2288   ,    -5904   ,     8192 },
    {8192     ,  -7533     ,   -659  }
};

static const HI_S16 as16M33RF2YF_601[3][3] =      // S1.14 [-32768, 32767]
{
    //BT601
    {4899    ,    9617     ,   1868 },
    { -2765   ,    -5427    ,    8192 },
    { 8192   ,    -6855    ,   -1332 }
};

static const HI_S16 as16DcOutRF2YL[3]  =       /* s10.0  [-1024,1023] */
{
    64,
    512,
    512
};

static const HI_S16 as16DcOutRF2YF[3] =
{
    0,
    512,
    512
};  // s10.0  [-1024,1023]

/* ------------------R2Y:RGB2RGB---------------------------- */
static const HI_U16  u16ScaleRF2RF      = 14;   // U4.0  [0,15]
static const HI_U16  u16ClipMinRF2RF_Y  = 0;    // U10.0  [0,1023]
static const HI_U16  u16ClipMaxRF2RF_Y  = 1023; // U10.0  [0,1023]
static const HI_U16  u16ClipMinRF2RF_UV = 0;    // U10.0  [0,1023]
static const HI_U16  u16ClipMaxRF2RF_UV = 1023; // U10.0  [0,1023]

static const HI_S16  as16DcInRF2RF[3] =      // S10.0  [-1024, 1023]
{
    0,
    0,
    0
};

static const HI_S16   as16M33RF2RF[3][3] =      // S1.14 [-32768, 32767]
{
    {16384    ,   0     ,   0  },
    { 0  ,     16384   ,     0 },
    { 0   ,    0    ,    16384  }
};

static const HI_S16   as16DcOutRF2RF[3] =
{
    0,
    0,
    0
};  // s10.0  [-1024,1023]

static HI_PQ_ACC_HISTGRAM_S gs_stACCHistGram;
static HI_U32 g_au32ToolTmClutTmp[64] = {0};
static HI_U32 g_au32ToolSmClutTmp[64] = {0};

static HI_PQ_HDR_TMAP_S g_stToolHdrTmap = {{0}};
static HI_PQ_HDR_SMAP_S g_stToolHdrSmap = {{0}};

static HI_U32 g_u32ACCOutWidth  = 3840;
static HI_U32 g_u32ACCOutHeight = 2160;
static HI_U32 g_u32HdrMode[HI_PQ_HDR_MODE_BUTT] =
{
    0,    0,    0,
    0,    0,    0,
    0,    0,    0,
    0,    0,    0
};
static HI_U32 g_u32ACCDarkStr[HI_PQ_HDR_MODE_BUTT] =
{
    0,    0,    0,
    0,    0,    0,
    0,    0,    0,
    0,    0,    0
};
static HI_U32 g_u32ACCBrightStr[HI_PQ_HDR_MODE_BUTT] =
{
    0,    0,    0,
    0,    0,    0,
    0,    0,    0,
    0,    0,    0
};
static HI_U32 g_u32DarkCvStr[HI_PQ_HDR_MODE_BUTT]    =
{
    50,    50,    50,
    50,    50,    50,
    50,    50,    50,
    50,    50,    50,
};
static HI_U32 g_u32BrightCvStr[HI_PQ_HDR_MODE_BUTT]  =
{
    50,    50,    50,
    50,    50,    50,
    50,    50,    50,
    50,    50,    50,
};

static HI_U32 g_u32Bright   = 128;
static HI_U32 g_u32Contrast = 128;
static HI_U32 g_u32Satu     = 128;
static HI_U32 g_u32Hue      = 128;

static HI_U32 g_u32Red      = 128;
static HI_U32 g_u32Green    = 128;
static HI_U32 g_u32Blue     = 128;

static HI_U32 g_u32HdrOffsetBright[HI_PQ_HDR_MODE_BUTT]   =
{
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
};
static HI_U32 g_u32HdrOffsetContrast[HI_PQ_HDR_MODE_BUTT] =
{
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
};
static HI_U32 g_u32HdrOffsetSatu[HI_PQ_HDR_MODE_BUTT]     =
{
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
};
static HI_U32 g_u32HdrOffsetHue[HI_PQ_HDR_MODE_BUTT]      =
{
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
};
static HI_U32 g_u32HdrOffsetRed[HI_PQ_HDR_MODE_BUTT]      =
{
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
};
static HI_U32 g_u32HdrOffsetGreen[HI_PQ_HDR_MODE_BUTT]    =
{
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
};
static HI_U32 g_u32HdrOffsetBlue[HI_PQ_HDR_MODE_BUTT]     =
{
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
    128,    128,    128,
};

#if defined(PQ_SIZE_UNUSED_CODE)
static const HI_U32 au32DeGmmLut_BT709[64] =                             //U21.0 [0,2097151]
{
    0 ,       228 ,       455 ,       910 ,      1366 ,      1821 ,      2731 ,      3642 ,
    5463 ,      7284 ,      9104 ,     10925 ,     12746 ,     14567 ,     18209 ,     21851 ,
    25492 ,     29134 ,     36418 ,     43827 ,     52116 ,     61201 ,     71096 ,     81811 ,
    93360 ,    105752 ,    118998 ,    133110 ,    148095 ,    163964 ,    180726 ,    198389 ,
    216963 ,    236454 ,    256871 ,    278223 ,    300515 ,    323756 ,    347952 ,    373111 ,
    399239 ,    426344 ,    454430 ,    483505 ,    513574 ,    544645 ,    576722 ,    609811 ,
    643919 ,    679050 ,    715210 ,    752404 ,    790639 ,    829918 ,    911631 ,    997583 ,
    1087813 ,   1182358 ,   1281254 ,   1384536 ,   1492238 ,   1604393 ,   1842194 ,   2097151 ,
};

static const HI_S16 as16M33GMAP_Ntsc_601_709[3][3] =
{
    //BT601 to BT709
    { 15394  ,       820     ,    167 },
    {  290   ,    15826    ,     269},
    {  -26   ,      -72   ,    16483  }
};

static const HI_S16 as16M33GMAP_Ntsc_601_2020[3][3] =
{
    //BT601 to BT2020
    {  9752    ,    5723   ,      908 },
    { 1331    ,   14606    ,     447 },
    {  254    ,    1342    ,   14788  }
};

static const HI_U32 au32TMLut_HDR2SDR[64]    =
{
    5000,    5000,    7000,    9000,    10568,    10091,    9768 ,    9531 ,
    9348 ,    9200 ,    9078 ,    8974 ,    8675 ,    8478 ,    8220 ,    8045 ,
    7912 ,    7801 ,    7619 ,    7467 ,    7332 ,    7209 ,    7093 ,    6680 ,
    6317 ,    5988 ,    5686 ,    5407 ,    5149 ,    4909 ,    4685 ,    4477 ,
    4282 ,    4099 ,    3929 ,    3769 ,    3619 ,    3104 ,    2698 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,
    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560 ,    2560
};

static const HI_U32 au32GmmLut_PQ4000[64] =              //U12.0 [0,4095]
{
    0 ,       108 ,       151 ,       182 ,       206 ,       278 ,       328 ,       367 ,
    477 ,       552 ,       609 ,       657 ,       698 ,       733 ,       765 ,       868 ,
    945 ,      1149 ,      1279 ,      1376 ,      1519 ,      1624 ,      1708 ,      1778 ,
    1838 ,      1891 ,      1938 ,      1980 ,      2019 ,      2055 ,      2087 ,      2118 ,
    2147 ,      2173 ,      2345 ,      2468 ,      2565 ,      2645 ,      2712 ,      2771 ,
    2823 ,      2870 ,      2912 ,      2951 ,      2987 ,      3020 ,      3051 ,      3079 ,
    3107 ,      3132 ,      3156 ,      3179 ,      3261 ,      3330 ,      3389 ,      3442 ,
    3489 ,      3531 ,      3570 ,      3605 ,      3638 ,      3668 ,      3697 ,      3697 ,
} ;

static const HI_U32 au32GmmLut_PQ2000[64] =              //U12.0 [0,4095]
{
    0 ,        77 ,       108 ,       132 ,       151 ,       206 ,       246 ,       278 ,
    367 ,       429 ,       477 ,       517 ,       552 ,       582 ,       609 ,       698 ,
    765 ,       945 ,      1062 ,      1149 ,      1279 ,      1376 ,      1454 ,      1519 ,
    1575 ,      1624 ,      1668 ,      1708 ,      1745 ,      1778 ,      1809 ,      1838 ,
    1866 ,      1891 ,      2055 ,      2173 ,      2267 ,      2345 ,      2411 ,      2468 ,
    2519 ,      2565 ,      2607 ,      2645 ,      2680 ,      2712 ,      2743 ,      2771 ,
    2798 ,      2823 ,      2847 ,      2870 ,      2951 ,      3020 ,      3079 ,      3132 ,
    3179 ,      3222 ,      3261 ,      3296 ,      3330 ,      3360 ,      3389 ,      3389 ,
} ;

static const HI_U32 au32GmmLut_PQ1200[64] =              //U12.0 [0,4095]
{
    0 ,        59 ,        84 ,       103 ,       118 ,       164 ,       197 ,       223 ,
    299 ,       352 ,       394 ,       429 ,       459 ,       486 ,       510 ,       588 ,
    648 ,       810 ,       916 ,       997 ,      1117 ,      1207 ,      1279 ,      1340 ,
    1393 ,      1440 ,      1481 ,      1519 ,      1554 ,      1585 ,      1615 ,      1643 ,
    1668 ,      1693 ,      1849 ,      1964 ,      2055 ,      2130 ,      2194 ,      2250 ,
    2300 ,      2345 ,      2385 ,      2423 ,      2457 ,      2489 ,      2519 ,      2547 ,
    2574 ,      2599 ,      2622 ,      2645 ,      2725 ,      2793 ,      2852 ,      2904 ,
    2951 ,      2994 ,      3032 ,      3068 ,      3101 ,      3132 ,      3161 ,      3161 ,
} ;

static const HI_U32 au32GmmLut_24[64] =              //U12.0 [0,4095]
{
    0 ,        14 ,        19 ,        23 ,        26 ,        36 ,        44 ,        50 ,
    68 ,        82 ,        93 ,       103 ,       112 ,       120 ,       128 ,       154 ,
    175 ,       240 ,       289 ,       329 ,       396 ,       451 ,       500 ,       543 ,
    582 ,       619 ,       653 ,       685 ,       715 ,       744 ,       771 ,       798 ,
    823 ,       848 ,      1019 ,      1162 ,      1286 ,      1397 ,      1498 ,      1592 ,
    1679 ,      1762 ,      1840 ,      1914 ,      1985 ,      2053 ,      2118 ,      2181 ,
    2242 ,      2301 ,      2358 ,      2414 ,      2623 ,      2813 ,      2989 ,      3153 ,
    3308 ,      3455 ,      3594 ,      3727 ,      3855 ,      3978 ,      4095 ,      4095 ,
};

static const HI_U32 au32GmmLut_bt709[64] =              //U12.0 [0,4095]
{
    0 ,         0 ,         0 ,         0 ,         0 ,         1 ,         1 ,         1 ,
    2 ,         3 ,         5 ,         6 ,         7 ,         8 ,         9 ,        14 ,
    18 ,        36 ,        54 ,        72 ,       108 ,       144 ,       180 ,       216 ,
    252 ,       288 ,       324 ,       360 ,       394 ,       426 ,       456 ,       486 ,
    514 ,       541 ,       730 ,       887 ,      1024 ,      1146 ,      1257 ,      1360 ,
    1457 ,      1547 ,      1632 ,      1714 ,      1792 ,      1866 ,      1938 ,      2007 ,
    2074 ,      2138 ,      2201 ,      2262 ,      2490 ,      2698 ,      2890 ,      3069 ,
    3238 ,      3398 ,      3549 ,      3694 ,      3833 ,      3967 ,      4095 ,      4095 ,
};

#endif

HI_S32 PQ_HAL_SetHDRTMCurve(HI_PQ_SETHDROFFSET_S *pstHdrOffsetPara)
{
    PQ_CHECK_NULL_PTR_RE_FAIL(pstHdrOffsetPara);

    g_u32HdrMode[pstHdrOffsetPara->enHdrProcessScene]        = pstHdrOffsetPara->u32HdrMode;
    g_u32ACCDarkStr[pstHdrOffsetPara->enHdrProcessScene]     = pstHdrOffsetPara->u32ACCdark;
    g_u32ACCBrightStr[pstHdrOffsetPara->enHdrProcessScene]   = pstHdrOffsetPara->u32ACCbrigt;
    g_u32DarkCvStr[pstHdrOffsetPara->enHdrProcessScene]      = pstHdrOffsetPara->u32darkCv;
    g_u32BrightCvStr[pstHdrOffsetPara->enHdrProcessScene]    = pstHdrOffsetPara->u32brightCv;

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_SetHdrCscSetting(HI_PQ_PICTURE_SETTING_S *pstPicSetting)
{
    PQ_CHECK_NULL_PTR_RE_FAIL(pstPicSetting);

    g_u32Bright   = (HI_U32)pstPicSetting->u16Brightness;
    g_u32Contrast = (HI_U32)pstPicSetting->u16Contrast;
    g_u32Satu     = (HI_U32)pstPicSetting->u16Hue;
    g_u32Hue      = (HI_U32)pstPicSetting->u16Saturation;

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_SetHdrOffset(HI_PQ_SETHDROFFSET_S *pstHdrOffsetPara)
{
    PQ_CHECK_NULL_PTR_RE_FAIL(pstHdrOffsetPara);

    g_u32HdrOffsetBright[pstHdrOffsetPara->enHdrProcessScene]   = pstHdrOffsetPara->u32Bright;
    g_u32HdrOffsetContrast[pstHdrOffsetPara->enHdrProcessScene] = pstHdrOffsetPara->u32Contrast;
    g_u32HdrOffsetSatu[pstHdrOffsetPara->enHdrProcessScene]     = pstHdrOffsetPara->u32Satu;
    g_u32HdrOffsetHue[pstHdrOffsetPara->enHdrProcessScene]      = pstHdrOffsetPara->u32Hue;
    g_u32HdrOffsetRed[pstHdrOffsetPara->enHdrProcessScene]      = pstHdrOffsetPara->u32R;
    g_u32HdrOffsetGreen[pstHdrOffsetPara->enHdrProcessScene]    = pstHdrOffsetPara->u32G;
    g_u32HdrOffsetBlue[pstHdrOffsetPara->enHdrProcessScene]     = pstHdrOffsetPara->u32B;

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_SetHDRACCHistGram(HI_U32 u32ACCOutWidth, HI_U32 u32ACCOutHeight, HI_PQ_ACC_HISTGRAM_S *pstACCHistGram)
{
    PQ_CHECK_NULL_PTR_RE_FAIL(pstACCHistGram);

    g_u32ACCOutWidth  = u32ACCOutWidth;
    g_u32ACCOutHeight = u32ACCOutHeight;

    memcpy(&gs_stACCHistGram, pstACCHistGram, sizeof(gs_stACCHistGram));

    return HI_SUCCESS;
}

HI_S32 HiHDR_DynTM(HI_PQ_ACC_HISTGRAM_S *pstACCHistGram, HI_U32 *TMLut, HI_U32 u32ACCOutWidth, HI_U32 u32ACCOutHeight)
{
    int i;// j;
    HI_S64 Tmp;
    HI_S64 TMLutTmp;
    HI_U32 u32Width  = u32ACCOutWidth;
    HI_U32 u32Height = u32ACCOutHeight;
    HI_U32 SumPixel  = (HI_U32)(u32Width * u32Height);
    HI_U32 Hist[8]   =  {0};  //ACC 8段直方图CV=[127,255,383,511,639,767,895,1023]  Lum=[0.15,3,22,103,419,1608,6215,10000] nits
    HI_U32 HistD3[3] = {0}; //ACC 三段动态直方图 CV=[0~P1, P0~P3, P2~1023]
    HI_U32 HistD5[5] = {0}; // 5段计算直方图，用于亮场景判别，CV=[0~P0, P0~P1, P1~P2, P2~P3, P3~1023]
    HI_U16 NormRange = 1000;
    HI_U16 HistNorm[8]      = {0};
    HI_U16 HistD5Norm[5]    = {0};
    HI_S16 LightLvlCoef[8]  = { -4, -2, -1, 0, 1, 2, 5, 1};
    HI_S32 LightLvlEst = 0;
    HI_U16 AlphaDarkGain   = g_u32ACCDarkStr[HI_PQ_HDR_MODE_HDR10_TO_SDR] * 1024 / 50;
    HI_U16 AlphaBrightGain = g_u32ACCBrightStr[HI_PQ_HDR_MODE_HDR10_TO_SDR] * 1024 / 50;
    HI_U16 AlphaGainScale  = 10;
    HI_U16 AlphaScale  = 15;
    HI_S32 AlphaDark   = 0;
    HI_S32 AlphaBright = 0;

    memcpy(HistD3,  pstACCHistGram->u32HistGram0, sizeof(HistD3));
    memcpy(Hist,    pstACCHistGram->u32HistGram1, sizeof(Hist));

    HistD5[0] = Hist[0] + Hist[1] + Hist[2] + Hist[3] + Hist[4];    //CV = 0~P0;
    HistD5[1] = HistD3[0] - HistD5[0];                              //CV = P0~P1;
    HistD5[2] = SumPixel - HistD3[0] - HistD3[2];                   //CV = P1~P2;
    HistD5[3] = HistD3[1] - HistD5[1] - HistD5[2];                  //CV = P2~P3;
    HistD5[4] = HistD3[2] - HistD5[3];                              //CV = P3~1023;

    PQ_CHECK_ZERO_RE_FAIL(SumPixel);

    for (i = 0; i < 8; i++)
    {
        HistNorm[i] = (HI_U16)(div64_s64(((HI_U64)Hist[i] * NormRange), SumPixel));
    }

    for (i = 0; i < 5; i++)
    {
        HistD5Norm[i] = (HI_U16)(div64_s64(((HI_U64)HistD5[i] * NormRange), SumPixel));
    }

    LightLvlEst = 0;
    HistNorm[0] = HDR_MAX(HistNorm[0] - 256, 0); //预处理减黑边；

    for (i = 0; i < 8; i++)
    {
        LightLvlEst += LightLvlCoef[i] * HistNorm[i];
    }

    pqprint(PQ_PRN_HDR, "Hist:%d,%d,%d,%d,%d,%d,%d,%d,%d,%d,%d\n",
            Hist[0], Hist[1], Hist[2], Hist[3], Hist[4], Hist[5], Hist[6], Hist[7], HistD3[0], HistD3[1], HistD3[2]);

    if (LightLvlEst <= -200)        //暗场景保护
    {
        pqprint(PQ_PRN_HDR, "LightLvlEstB:%d\n", LightLvlEst);

        if (LightLvlEst > -600)
        {
            AlphaDark = (HI_S32)(((abs(LightLvlEst) - 200) * 600 / (600 - 200) ) << AlphaScale) / 1500;
        }
        else
        {
            AlphaDark = (HI_S32)((abs(LightLvlEst)) << AlphaScale) / 1500;
        }

        pqprint(PQ_PRN_HDR, "AlphaD0:%d\n", AlphaDark);

        AlphaDark = HDR_CLIP3(0, (3 << AlphaScale) / 2, AlphaDark);

        pqprint(PQ_PRN_HDR, "AlphaD1:%d\n", AlphaDark);
        pqprint(PQ_PRN_HDR, "AlphaDarkGain:%d\n", AlphaDarkGain);

        AlphaDark = (HI_S32)(((HI_S64)AlphaDark * AlphaDarkGain) >> AlphaGainScale);
        Tmp = (1 << AlphaScale) - AlphaDark;

        pqprint(PQ_PRN_HDR, "Tmp,AlphaD:%d,%d\n", (HI_S32)Tmp, AlphaDark);

        for (i = 0; i < 64; i++)
        {
            TMLutTmp = ((HI_S64)Tmp * TMLut[i] + (HI_S64)AlphaDark * au32TMLut_HDR2SDR_DP[i]) >> AlphaScale;
            TMLut[i] = (HI_U32)HDR_CLIP3(0, 65535, TMLutTmp);
        }
    }
    else if (LightLvlEst >= 100)
    {
        pqprint(PQ_PRN_HDR, "LightLvlEstB:%d\n", LightLvlEst);

        if (LightLvlEst < 300)
        {
            AlphaBright = (HI_S32)(((abs(LightLvlEst) - 100) * 300 / (300 - 100) ) << AlphaScale) / 500;
        }
        else
        {
            AlphaBright = (HI_S32)((abs(LightLvlEst)) << AlphaScale) / 500;
        }

        pqprint(PQ_PRN_HDR, "AlphaB0:%d\n", AlphaBright);

        AlphaBright = HDR_CLIP3(0, (3 << AlphaScale) / 2, AlphaBright);

        pqprint(PQ_PRN_HDR, "AlphaB1:%d\n", AlphaBright);
        pqprint(PQ_PRN_HDR, "AlphaBrightGain:%d\n", AlphaBrightGain);

        AlphaBright = (HI_S32)(((HI_S64)AlphaBright * AlphaBrightGain) >> AlphaGainScale);
        Tmp = (1 << AlphaScale) - AlphaBright;

        pqprint(PQ_PRN_HDR, "Tmp,AlphaB:%d,%d\n", (HI_S32)Tmp, AlphaBright);

        for (i = 0; i < 64; i++)
        {
            TMLutTmp = ((HI_S64)Tmp * TMLut[i] + (HI_S64)AlphaBright * au32TMLut_HDR2SDR_BP[i]) >> AlphaScale;
            TMLut[i] = (HI_U32)HDR_CLIP3(0, 65535, TMLutTmp);
        }
    }
    else
    {
    }

    return HI_SUCCESS;
}

static HI_VOID PQ_hal_CalCSCCoefRGBtoYCbCr(HI_U32 Contrast, HI_U32 Saturation, HI_U32 Hue,
        HI_U32 Kr, HI_U32 Kg, HI_U32 Kb, HI_S16 pCSCTable[3][3], HI_S16 pDstCSCTable[3][3])
{
    HI_S32 ContrastAdjust;
    HI_S32 SaturationAdjust;
    HI_S32 rGain, gGain, bGain;

    ContrastAdjust   = Contrast   * 40 / 51;
    SaturationAdjust = Saturation * 40 / 51;
    Hue   = Hue * 60 / 255;
    rGain = Kr  * 40 / 51;
    gGain = Kg  * 40 / 51;
    bGain = Kb  * 40 / 51;

    g_aDstCSCTable[0][0] = (HI_S16)((HI_S32)pCSCTable[0][0] * ContrastAdjust * rGain  / 10000);
    g_aDstCSCTable[0][1] = (HI_S16)((HI_S32)pCSCTable[0][1] * ContrastAdjust * gGain  / 10000);
    g_aDstCSCTable[0][2] = (HI_S16)((HI_S32)pCSCTable[0][2] * ContrastAdjust * bGain  / 10000);
    g_aDstCSCTable[1][0]  = (HI_S16)(((HI_S32)(pCSCTable[1][0] * g_au32CosTable[Hue]) / 1000
                                      + (HI_S32)(pCSCTable[2][0] * g_au32SinTable[Hue]) / 1000)
                                     * SaturationAdjust * rGain / 10000);
    g_aDstCSCTable[1][1]  = (HI_S16)(((HI_S32)(pCSCTable[1][1] * g_au32CosTable[Hue]) / 1000
                                      + (HI_S32)(pCSCTable[2][1] * g_au32SinTable[Hue]) / 1000)
                                     * SaturationAdjust * gGain  / 10000);
    g_aDstCSCTable[1][2]  = (HI_S16)(((HI_S32)(pCSCTable[1][2] * g_au32CosTable[Hue]) / 1000
                                      + (HI_S32)(pCSCTable[2][2] * g_au32SinTable[Hue]) / 1000)
                                     * SaturationAdjust * bGain  / 10000);
    g_aDstCSCTable[2][0] = (HI_S16)(((HI_S32)(pCSCTable[2][0] * g_au32CosTable[Hue]) / 1000
                                     - (HI_S32)(pCSCTable[1][0] * g_au32SinTable[Hue]) / 1000)
                                    * SaturationAdjust * rGain  / 10000);
    g_aDstCSCTable[2][1] = (HI_S16)(((HI_S32)(pCSCTable[2][1] * g_au32CosTable[Hue]) / 1000
                                     - (HI_S32)(pCSCTable[1][1] * g_au32SinTable[Hue]) / 1000)
                                    * SaturationAdjust * gGain  / 10000);
    g_aDstCSCTable[2][2] = (HI_S16)(((HI_S32)(pCSCTable[2][2] * g_au32CosTable[Hue]) / 1000
                                     - (HI_S32)(pCSCTable[1][2] * g_au32SinTable[Hue]) / 1000)
                                    * SaturationAdjust * bGain  / 10000);
    return;
}

static HI_VOID PQ_hal_HdrOffsetCalCSCCoefRGBtoYCbCr(HI_PQ_HDR_MODE_E enHdrProcessScene, HI_U32 Contrast, HI_U32 Saturation,
        HI_U32 Hue, HI_U32 Kr, HI_U32 Kg, HI_U32 Kb, HI_S16 pCSCTable[3][3], HI_S16 pDstCSCTable[3][3])
{
    HI_S32 ContrastAdjust;
    HI_S32 SaturationAdjust;
    HI_S32 rGain, gGain, bGain;

    ContrastAdjust   = Contrast   * 40 / 51;
    SaturationAdjust = Saturation * 40 / 51;
    Hue   = Hue * 60 / 255;
    rGain = Kr  * 40 / 51;
    gGain = Kg  * 40 / 51;
    bGain = Kb  * 40 / 51;

    g_aDstHdrOffsetCSCTable[enHdrProcessScene][0][0] = (HI_S16)((HI_S32)pCSCTable[0][0] * ContrastAdjust * rGain  / 10000);
    g_aDstHdrOffsetCSCTable[enHdrProcessScene][0][1] = (HI_S16)((HI_S32)pCSCTable[0][1] * ContrastAdjust * gGain  / 10000);
    g_aDstHdrOffsetCSCTable[enHdrProcessScene][0][2] = (HI_S16)((HI_S32)pCSCTable[0][2] * ContrastAdjust * bGain  / 10000);
    g_aDstHdrOffsetCSCTable[enHdrProcessScene][1][0]  = (HI_S16)(((HI_S32)(pCSCTable[1][0] * g_au32CosTable[Hue]) / 1000
            + (HI_S32)(pCSCTable[2][0] * g_au32SinTable[Hue]) / 1000)
            * SaturationAdjust * rGain / 10000);
    g_aDstHdrOffsetCSCTable[enHdrProcessScene][1][1]  = (HI_S16)(((HI_S32)(pCSCTable[1][1] * g_au32CosTable[Hue]) / 1000
            + (HI_S32)(pCSCTable[2][1] * g_au32SinTable[Hue]) / 1000)
            * SaturationAdjust * gGain  / 10000);
    g_aDstHdrOffsetCSCTable[enHdrProcessScene][1][2]  = (HI_S16)(((HI_S32)(pCSCTable[1][2] * g_au32CosTable[Hue]) / 1000
            + (HI_S32)(pCSCTable[2][2] * g_au32SinTable[Hue]) / 1000)
            * SaturationAdjust * bGain  / 10000);
    g_aDstHdrOffsetCSCTable[enHdrProcessScene][2][0] = (HI_S16)(((HI_S32)(pCSCTable[2][0] * g_au32CosTable[Hue]) / 1000
            - (HI_S32)(pCSCTable[1][0] * g_au32SinTable[Hue]) / 1000)
            * SaturationAdjust * rGain  / 10000);
    g_aDstHdrOffsetCSCTable[enHdrProcessScene][2][1] = (HI_S16)(((HI_S32)(pCSCTable[2][1] * g_au32CosTable[Hue]) / 1000
            - (HI_S32)(pCSCTable[1][1] * g_au32SinTable[Hue]) / 1000)
            * SaturationAdjust * gGain  / 10000);
    g_aDstHdrOffsetCSCTable[enHdrProcessScene][2][2] = (HI_S16)(((HI_S32)(pCSCTable[2][2] * g_au32CosTable[Hue]) / 1000
            - (HI_S32)(pCSCTable[1][2] * g_au32SinTable[Hue]) / 1000)
            * SaturationAdjust * bGain  / 10000);
    return;
}


HI_S32 PQ_HAL_CalcHdrTmapACCHistGram(HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    PQ_CHECK_NULL_PTR_RE_FAIL(pstPqHdrCfg);

    HiHDR_DynTM(&gs_stACCHistGram, pstPqHdrCfg->stTMAP.pu32LUTTM, g_u32ACCOutWidth, g_u32ACCOutHeight);

    return HI_SUCCESS;
}

static HI_S32 pq_hal_SetY2RMatrix(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->stY2R.u16ScaleY2R = u16Y2RScale;

    switch (enInCS)
    {
        case HI_DRV_CS_BT2020_YUV_LIMITED:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16Y2RM33_2020L,   sizeof(pstPqHdrCfg->stY2R.as16M33Y2R));
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16Y2RDcInLimit,      sizeof(pstPqHdrCfg->stY2R.as16DcInY2R));
            break;
        case HI_DRV_CS_BT2020_YUV_FULL:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16Y2RM33_2020F,   sizeof(pstPqHdrCfg->stY2R.as16M33Y2R));
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16Y2RDcInFull,      sizeof(pstPqHdrCfg->stY2R.as16DcInY2R));
            break;
        case HI_DRV_CS_BT709_YUV_LIMITED:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16Y2RM33_709L,    sizeof(pstPqHdrCfg->stY2R.as16M33Y2R));
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16Y2RDcInLimit,      sizeof(pstPqHdrCfg->stY2R.as16DcInY2R));
            break;
        case HI_DRV_CS_BT709_YUV_FULL:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16Y2RM33_709F,    sizeof(pstPqHdrCfg->stY2R.as16M33Y2R));
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16Y2RDcInFull,      sizeof(pstPqHdrCfg->stY2R.as16DcInY2R));
            break;
        case HI_DRV_CS_BT601_YUV_LIMITED:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16Y2RM33_601L,    sizeof(pstPqHdrCfg->stY2R.as16M33Y2R));
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16Y2RDcInLimit,      sizeof(pstPqHdrCfg->stY2R.as16DcInY2R));
            break;
        case HI_DRV_CS_BT601_YUV_FULL:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16Y2RM33_601F,    sizeof(pstPqHdrCfg->stY2R.as16M33Y2R));
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16Y2RDcInFull,      sizeof(pstPqHdrCfg->stY2R.as16DcInY2R));
            break;
        default:
            memcpy(pstPqHdrCfg->stY2R.as16M33Y2R,   as16Y2RM33_2020L,   sizeof(pstPqHdrCfg->stY2R.as16M33Y2R));
            memcpy(pstPqHdrCfg->stY2R.as16DcInY2R,  as16Y2RDcInLimit,      sizeof(pstPqHdrCfg->stY2R.as16DcInY2R));
            break;
    }

    memcpy(pstPqHdrCfg->stY2R.as16DcOutY2R, as16Y2RDcOut, sizeof(pstPqHdrCfg->stY2R.as16DcOutY2R));
    pstPqHdrCfg->stY2R.u16ClipMinY2R = u16Y2RClipMin;
    pstPqHdrCfg->stY2R.u16ClipMaxY2R = u16Y2RClipMax;

    return HI_SUCCESS;
}

static HI_S32 pq_hal_SetGamutMappingPara(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    /* GamutMapping */
    pstPqHdrCfg->stGMAP.u16ScaleGMAP = u16GMapScale;

    pstPqHdrCfg->stGMAP.u32ClipMinGMAP = u32GMapClipMin;
    pstPqHdrCfg->stGMAP.u32ClipMaxGMAP = u32GMapClipMax;

    if (((HI_DRV_CS_BT2020_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT2020_YUV_FULL == enInCS))
        && ((HI_DRV_CS_BT709_YUV_LIMITED == enOutCS) || (HI_DRV_CS_BT709_YUV_FULL == enOutCS))) /* 2020->709 */
    {
        memcpy(pstPqHdrCfg->stGMAP.as16M33GMAP, as16M33GMap_2020to709, sizeof(pstPqHdrCfg->stGMAP.as16M33GMAP));
    }
    else if (((HI_DRV_CS_BT2020_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT2020_YUV_FULL == enInCS))
             && ((HI_DRV_CS_BT2020_YUV_LIMITED == enOutCS) || (HI_DRV_CS_BT2020_YUV_FULL == enOutCS)))/* 2020->2020 */
    {
        memcpy(pstPqHdrCfg->stGMAP.as16M33GMAP, as16M33GMap_linear, sizeof(pstPqHdrCfg->stGMAP.as16M33GMAP));
    }
    else if (((HI_DRV_CS_BT709_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT709_YUV_FULL == enInCS))
             && ((HI_DRV_CS_BT2020_YUV_LIMITED == enOutCS) || (HI_DRV_CS_BT2020_YUV_FULL == enOutCS)))/* 709->2020 */
    {
        memcpy(pstPqHdrCfg->stGMAP.as16M33GMAP, as16M33GMap_709to2020, sizeof(pstPqHdrCfg->stGMAP.as16M33GMAP));
    }
    else if (((HI_DRV_CS_BT601_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT601_YUV_FULL == enInCS))
             && ((HI_DRV_CS_BT2020_YUV_LIMITED == enOutCS) || (HI_DRV_CS_BT2020_YUV_FULL == enOutCS)))/* 601->2020 */
    {
        memcpy(pstPqHdrCfg->stGMAP.as16M33GMAP, as16M33GMAP_Pal_601_2020, sizeof(pstPqHdrCfg->stGMAP.as16M33GMAP));
    }
    else if (((HI_DRV_CS_BT601_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT601_YUV_FULL == enInCS))
             && ((HI_DRV_CS_BT709_YUV_LIMITED == enOutCS) || (HI_DRV_CS_BT709_YUV_FULL == enOutCS)))/* 601->709 */
    {
        memcpy(pstPqHdrCfg->stGMAP.as16M33GMAP, as16M33GMAP_Pal_601_709, sizeof(pstPqHdrCfg->stGMAP.as16M33GMAP));
    }
    else
    {
        memcpy(pstPqHdrCfg->stGMAP.as16M33GMAP, as16M33GMap_linear, sizeof(pstPqHdrCfg->stGMAP.as16M33GMAP));
    }

    return HI_SUCCESS;
}

static HI_S32 pq_hal_SetHDRTMap(HI_DRV_COLOR_SPACE_E enInCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->stTMAP.u16ScaleLumaCal = u16TmScaleLumaCal;

    if ((HI_DRV_CS_BT709_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT709_YUV_FULL == enInCS))
    {
        memcpy(pstPqHdrCfg->stTMAP.au16M3LumaCal, au16TmM3LumaCal_709, sizeof(pstPqHdrCfg->stTMAP.au16M3LumaCal));
    }
    else if ((HI_DRV_CS_BT2020_YUV_LIMITED == enInCS) || (HI_DRV_CS_BT2020_YUV_FULL == enInCS))
    {
        memcpy(pstPqHdrCfg->stTMAP.au16M3LumaCal, au16TmM3LumaCal_2020, sizeof(pstPqHdrCfg->stTMAP.au16M3LumaCal));
    }
    else
    {
        memcpy(pstPqHdrCfg->stTMAP.au16M3LumaCal, au16TmM3LumaCal_601, sizeof(pstPqHdrCfg->stTMAP.au16M3LumaCal));
    }

    pstPqHdrCfg->stTMAP.u32ClipMinTM = u32TmClipMin;
    pstPqHdrCfg->stTMAP.u32ClipMaxTM = u32TmClipMax;
    PQ_SAFE_MEMSET(pstPqHdrCfg->stTMAP.as32TMOff, 0, sizeof(pstPqHdrCfg->stTMAP.as32TMOff));
    pqprint(PQ_PRN_HDR, "HdrMode:%d\n", g_u32HdrMode);

    switch (sg_enHDRMode)
    {
        case HI_PQ_HDR_MODE_HDR10_TO_SDR:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_HDR2SDR;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, sg_stHdrTmClutBinOrCode.au32Step[PQ_TOOL_HDR2SDR], sizeof(pstPqHdrCfg->stTMAP.au32StepTM));
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  sg_stHdrTmClutBinOrCode.au32Num[PQ_TOOL_HDR2SDR],  sizeof(pstPqHdrCfg->stTMAP.au32NumTM ));
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  sg_stHdrTmClutBinOrCode.au32Pos[PQ_TOOL_HDR2SDR],  sizeof(pstPqHdrCfg->stTMAP.au32PosTM ));
            memcpy(g_au32ToolTmClutTmp, sg_stHdrTmClutBinOrCode.au32Clut[PQ_TOOL_HDR2SDR], sizeof(g_au32ToolTmClutTmp));
            break;
        case HI_PQ_HDR_MODE_HDR10_TO_HDR10:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_Linear;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(pstPqHdrCfg->stTMAP.au32StepTM));
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(pstPqHdrCfg->stTMAP.au32NumTM ));
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(pstPqHdrCfg->stTMAP.au32PosTM ));
            memcpy(g_au32ToolTmClutTmp, au32TMLut_Linear, sizeof(g_au32ToolTmClutTmp));
            break;
        case HI_PQ_HDR_MODE_HDR10_TO_HLG:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_HDR2HLG;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(pstPqHdrCfg->stTMAP.au32StepTM));
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(pstPqHdrCfg->stTMAP.au32NumTM ));
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(pstPqHdrCfg->stTMAP.au32PosTM ));
            memcpy(g_au32ToolTmClutTmp, au32TMLut_HDR2HLG, sizeof(g_au32ToolTmClutTmp));
            break;
        case HI_PQ_HDR_MODE_HLG_TO_SDR:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_HLG2SDR;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(pstPqHdrCfg->stTMAP.au32StepTM));
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(pstPqHdrCfg->stTMAP.au32NumTM ));
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(pstPqHdrCfg->stTMAP.au32PosTM ));
            memcpy(g_au32ToolTmClutTmp, au32TMLut_HLG2SDR, sizeof(g_au32ToolTmClutTmp));
            break;
        case HI_PQ_HDR_MODE_HLG_TO_HDR10:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_HLG2HDR;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(pstPqHdrCfg->stTMAP.au32StepTM));
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(pstPqHdrCfg->stTMAP.au32NumTM ));
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(pstPqHdrCfg->stTMAP.au32PosTM ));
            memcpy(g_au32ToolTmClutTmp, au32TMLut_HLG2HDR, sizeof(g_au32ToolTmClutTmp));
            break;
        case HI_PQ_HDR_MODE_HLG_TO_HLG:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_Linear;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(pstPqHdrCfg->stTMAP.au32StepTM));
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(pstPqHdrCfg->stTMAP.au32NumTM ));
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(pstPqHdrCfg->stTMAP.au32PosTM ));
            memcpy(g_au32ToolTmClutTmp, au32TMLut_Linear, sizeof(g_au32ToolTmClutTmp));
            break;
        case HI_PQ_HDR_MODE_SLF_TO_SDR:
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(pstPqHdrCfg->stTMAP.au32StepTM));
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(pstPqHdrCfg->stTMAP.au32NumTM ));
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(pstPqHdrCfg->stTMAP.au32PosTM ));
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_SLF2SDR;
            memcpy(g_au32ToolTmClutTmp, au32TMLut_SLF2SDR, sizeof(g_au32ToolTmClutTmp));
            break;
        case HI_PQ_HDR_MODE_SLF_TO_HDR10:
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(pstPqHdrCfg->stTMAP.au32StepTM));
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(pstPqHdrCfg->stTMAP.au32NumTM ));
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(pstPqHdrCfg->stTMAP.au32PosTM ));
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_Linear;
            memcpy(g_au32ToolTmClutTmp, au32TMLut_Linear, sizeof(g_au32ToolTmClutTmp));
            break;
        case HI_PQ_HDR_MODE_SDR_TO_HDR10:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_SDR2HDR;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, sg_stHdrTmClutBinOrCode.au32Step[PQ_TOOL_HDR2SDR], sizeof(pstPqHdrCfg->stTMAP.au32StepTM));
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  sg_stHdrTmClutBinOrCode.au32Num[PQ_TOOL_HDR2SDR],  sizeof(pstPqHdrCfg->stTMAP.au32NumTM ));
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  sg_stHdrTmClutBinOrCode.au32Pos[PQ_TOOL_HDR2SDR],  sizeof(pstPqHdrCfg->stTMAP.au32PosTM ));
            memcpy(g_au32ToolTmClutTmp, sg_stHdrTmClutBinOrCode.au32Clut[PQ_TOOL_SDR2HDR], sizeof(g_au32ToolTmClutTmp));
            break;
        case HI_PQ_HDR_MODE_SDR_TO_HLG:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_SDR2HLG1000;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(pstPqHdrCfg->stTMAP.au32StepTM));
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(pstPqHdrCfg->stTMAP.au32NumTM ));
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(pstPqHdrCfg->stTMAP.au32PosTM ));
            memcpy(g_au32ToolTmClutTmp, au32TMLut_SDR2HLG1000, sizeof(g_au32ToolTmClutTmp));
            break;
        default:
            pstPqHdrCfg->stTMAP.u16ScaleCoefTM = u16ScaleCoefTM_Linear;
            memcpy(pstPqHdrCfg->stTMAP.au32StepTM, au32TMapStep, sizeof(pstPqHdrCfg->stTMAP.au32StepTM));
            memcpy(pstPqHdrCfg->stTMAP.au32NumTM,  au32TMapNum,  sizeof(pstPqHdrCfg->stTMAP.au32NumTM ));
            memcpy(pstPqHdrCfg->stTMAP.au32PosTM,  au32TMapPos,  sizeof(pstPqHdrCfg->stTMAP.au32PosTM ));
            memcpy(g_au32ToolTmClutTmp, au32TMLut_Linear, sizeof(g_au32ToolTmClutTmp));
            break;
    }

    sg_au16ToolTmScale = pstPqHdrCfg->stTMAP.u16ScaleCoefTM;

    if (0 == sg_u32ToolHdrTmMode)
    {
        memcpy(pstPqHdrCfg->stTMAP.pu32LUTTM, g_au32ToolTmClutTmp, sizeof(pstPqHdrCfg->stTMAP.pu32LUTTM));

        memcpy(g_stToolHdrTmap.au32X_step,  pstPqHdrCfg->stTMAP.au32StepTM, sizeof(pstPqHdrCfg->stTMAP.au32StepTM));
        memcpy(g_stToolHdrTmap.au32X_num,   pstPqHdrCfg->stTMAP.au32NumTM,  sizeof(pstPqHdrCfg->stTMAP.au32NumTM ));
        memcpy(g_stToolHdrTmap.au32X_pos,   pstPqHdrCfg->stTMAP.au32PosTM,  sizeof(pstPqHdrCfg->stTMAP.au32PosTM ));
        memcpy(g_stToolHdrTmap.au32Y_LUT,   pstPqHdrCfg->stTMAP.pu32LUTTM,  sizeof(g_stToolHdrTmap.au32Y_LUT));
    }
    else if (1 == sg_u32ToolHdrTmMode)
    {
        memcpy(pstPqHdrCfg->stTMAP.au32StepTM,  g_stToolHdrTmap.au32X_step, sizeof(pstPqHdrCfg->stTMAP.au32StepTM));
        memcpy(pstPqHdrCfg->stTMAP.au32NumTM ,  g_stToolHdrTmap.au32X_num,  sizeof(pstPqHdrCfg->stTMAP.au32NumTM ));
        memcpy(pstPqHdrCfg->stTMAP.au32PosTM ,  g_stToolHdrTmap.au32X_pos,  sizeof(pstPqHdrCfg->stTMAP.au32PosTM ));
        memcpy(pstPqHdrCfg->stTMAP.pu32LUTTM,   g_stToolHdrTmap.au32Y_LUT,  sizeof(pstPqHdrCfg->stTMAP.pu32LUTTM));
    }

    return HI_SUCCESS;
}

static HI_S32 pq_hal_SetHDRSMap(HI_DRV_COLOR_SPACE_E enInCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    /* ToneMapping Smap */
    pstPqHdrCfg->stCadj.u16Scale2P = u16SmapScaleCoef;

    switch (sg_enHDRMode)
    {
        case HI_PQ_HDR_MODE_HDR10_TO_SDR:
            memcpy(pstPqHdrCfg->stSMAP.au32StepSM, sg_stHdrSmClutBinOrCode.au32Step[PQ_TOOL_HDR2SDR], sizeof(pstPqHdrCfg->stSMAP.au32StepSM));
            memcpy(pstPqHdrCfg->stSMAP.au32NumSM , sg_stHdrSmClutBinOrCode.au32Num[PQ_TOOL_HDR2SDR],  sizeof(pstPqHdrCfg->stSMAP.au32NumSM ));
            memcpy(pstPqHdrCfg->stSMAP.au32PosSM , sg_stHdrSmClutBinOrCode.au32Pos[PQ_TOOL_HDR2SDR],  sizeof(pstPqHdrCfg->stSMAP.au32PosSM ));
            memcpy(g_au32ToolSmClutTmp, sg_stHdrSmClutBinOrCode.au32Clut[PQ_TOOL_HDR2SDR], sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));
            break;
        case HI_PQ_HDR_MODE_HDR10_TO_HDR10:
            memcpy(pstPqHdrCfg->stSMAP.au32StepSM, au32SMapStep, sizeof(pstPqHdrCfg->stSMAP.au32StepSM));
            memcpy(pstPqHdrCfg->stSMAP.au32NumSM , au32SMapNum,  sizeof(pstPqHdrCfg->stSMAP.au32NumSM ));
            memcpy(pstPqHdrCfg->stSMAP.au32PosSM , au32SMapPos,  sizeof(pstPqHdrCfg->stSMAP.au32PosSM ));
            memcpy(g_au32ToolSmClutTmp, au32SMLutLinear, sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));
            break;
        case HI_PQ_HDR_MODE_HDR10_TO_HLG:
            memcpy(pstPqHdrCfg->stSMAP.au32StepSM, au32SMapStep, sizeof(pstPqHdrCfg->stSMAP.au32StepSM));
            memcpy(pstPqHdrCfg->stSMAP.au32NumSM , au32SMapNum,  sizeof(pstPqHdrCfg->stSMAP.au32NumSM ));
            memcpy(pstPqHdrCfg->stSMAP.au32PosSM , au32SMapPos,  sizeof(pstPqHdrCfg->stSMAP.au32PosSM ));
            memcpy(g_au32ToolSmClutTmp, au32SMLutLinear, sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));
            break;
        case HI_PQ_HDR_MODE_HLG_TO_SDR:
            memcpy(pstPqHdrCfg->stSMAP.au32StepSM, au32SMapStep, sizeof(pstPqHdrCfg->stSMAP.au32StepSM));
            memcpy(pstPqHdrCfg->stSMAP.au32NumSM , au32SMapNum,  sizeof(pstPqHdrCfg->stSMAP.au32NumSM ));
            memcpy(pstPqHdrCfg->stSMAP.au32PosSM , au32SMapPos,  sizeof(pstPqHdrCfg->stSMAP.au32PosSM ));
            memcpy(g_au32ToolSmClutTmp, au32SMLut_HLG2SDR, sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));
            break;
        case HI_PQ_HDR_MODE_HLG_TO_HDR10:
            memcpy(pstPqHdrCfg->stSMAP.au32StepSM, au32SMapStep, sizeof(pstPqHdrCfg->stSMAP.au32StepSM));
            memcpy(pstPqHdrCfg->stSMAP.au32NumSM , au32SMapNum,  sizeof(pstPqHdrCfg->stSMAP.au32NumSM ));
            memcpy(pstPqHdrCfg->stSMAP.au32PosSM , au32SMapPos,  sizeof(pstPqHdrCfg->stSMAP.au32PosSM ));
            memcpy(g_au32ToolSmClutTmp, au32SMLutLinear, sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));
            break;
        case HI_PQ_HDR_MODE_HLG_TO_HLG:
            memcpy(pstPqHdrCfg->stSMAP.au32StepSM, au32SMapStep, sizeof(pstPqHdrCfg->stSMAP.au32StepSM));
            memcpy(pstPqHdrCfg->stSMAP.au32NumSM , au32SMapNum,  sizeof(pstPqHdrCfg->stSMAP.au32NumSM ));
            memcpy(pstPqHdrCfg->stSMAP.au32PosSM , au32SMapPos,  sizeof(pstPqHdrCfg->stSMAP.au32PosSM ));
            memcpy(g_au32ToolSmClutTmp, au32SMLutLinear, sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));
            break;
        case HI_PQ_HDR_MODE_SLF_TO_SDR:
            memcpy(pstPqHdrCfg->stSMAP.au32StepSM, au32SMapStep, sizeof(pstPqHdrCfg->stSMAP.au32StepSM));
            memcpy(pstPqHdrCfg->stSMAP.au32NumSM , au32SMapNum,  sizeof(pstPqHdrCfg->stSMAP.au32NumSM ));
            memcpy(pstPqHdrCfg->stSMAP.au32PosSM , au32SMapPos,  sizeof(pstPqHdrCfg->stSMAP.au32PosSM ));
            memcpy(g_au32ToolSmClutTmp, au32SMLut_SLF2SDR, sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));
            break;
        case HI_PQ_HDR_MODE_SLF_TO_HDR10:
            memcpy(pstPqHdrCfg->stSMAP.au32StepSM, au32SMapStep, sizeof(pstPqHdrCfg->stSMAP.au32StepSM));
            memcpy(pstPqHdrCfg->stSMAP.au32NumSM , au32SMapNum,  sizeof(pstPqHdrCfg->stSMAP.au32NumSM ));
            memcpy(pstPqHdrCfg->stSMAP.au32PosSM , au32SMapPos,  sizeof(pstPqHdrCfg->stSMAP.au32PosSM ));
            memcpy(g_au32ToolSmClutTmp, au32SMLutLinear, sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));
            break;
        case HI_PQ_HDR_MODE_SDR_TO_HDR10:
            memcpy(pstPqHdrCfg->stSMAP.au32StepSM, sg_stHdrSmClutBinOrCode.au32Step[PQ_TOOL_SDR2HDR], sizeof(pstPqHdrCfg->stSMAP.au32StepSM));
            memcpy(pstPqHdrCfg->stSMAP.au32NumSM , sg_stHdrSmClutBinOrCode.au32Num[PQ_TOOL_SDR2HDR],  sizeof(pstPqHdrCfg->stSMAP.au32NumSM ));
            memcpy(pstPqHdrCfg->stSMAP.au32PosSM , sg_stHdrSmClutBinOrCode.au32Pos[PQ_TOOL_SDR2HDR],  sizeof(pstPqHdrCfg->stSMAP.au32PosSM ));
            memcpy(g_au32ToolSmClutTmp, sg_stHdrSmClutBinOrCode.au32Clut[PQ_TOOL_SDR2HDR], sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));
            break;
        case HI_PQ_HDR_MODE_SDR_TO_HLG:
            memcpy(pstPqHdrCfg->stSMAP.au32StepSM, au32SMapStep, sizeof(pstPqHdrCfg->stSMAP.au32StepSM));
            memcpy(pstPqHdrCfg->stSMAP.au32NumSM , au32SMapNum,  sizeof(pstPqHdrCfg->stSMAP.au32NumSM ));
            memcpy(pstPqHdrCfg->stSMAP.au32PosSM , au32SMapPos,  sizeof(pstPqHdrCfg->stSMAP.au32PosSM ));
            memcpy(g_au32ToolSmClutTmp, au32SMLut_SDR2HDR, sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));
            break;
        default:
            memcpy(pstPqHdrCfg->stSMAP.au32StepSM, au32SMapStep, sizeof(pstPqHdrCfg->stSMAP.au32StepSM));
            memcpy(pstPqHdrCfg->stSMAP.au32NumSM , au32SMapNum,  sizeof(pstPqHdrCfg->stSMAP.au32NumSM ));
            memcpy(pstPqHdrCfg->stSMAP.au32PosSM , au32SMapPos,  sizeof(pstPqHdrCfg->stSMAP.au32PosSM ));
            memcpy(g_au32ToolSmClutTmp, au32SMLutLinear, sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));
            break;
    }


    sg_au16ToolSmScale = pstPqHdrCfg->stCadj.u16Scale2P;

    if (0 == sg_u32ToolHdrSmMode)
    {
        memcpy(pstPqHdrCfg->stSMAP.pu32LUTSM, g_au32ToolSmClutTmp, sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));

        memcpy(g_stToolHdrSmap.au32X_step,  pstPqHdrCfg->stSMAP.au32StepSM, sizeof(pstPqHdrCfg->stSMAP.au32StepSM));
        memcpy(g_stToolHdrSmap.au32X_num,   pstPqHdrCfg->stSMAP.au32NumSM,  sizeof(pstPqHdrCfg->stSMAP.au32NumSM ));
        memcpy(g_stToolHdrSmap.au32X_pos,   pstPqHdrCfg->stSMAP.au32PosSM,  sizeof(pstPqHdrCfg->stSMAP.au32PosSM ));
        memcpy(g_stToolHdrSmap.au32Y_LUT,   pstPqHdrCfg->stSMAP.pu32LUTSM,  sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));
    }
    else if (1 == sg_u32ToolHdrSmMode)
    {
        memcpy(pstPqHdrCfg->stSMAP.au32StepSM,  g_stToolHdrSmap.au32X_step, sizeof(pstPqHdrCfg->stSMAP.au32StepSM));
        memcpy(pstPqHdrCfg->stSMAP.au32NumSM ,  g_stToolHdrSmap.au32X_num,  sizeof(pstPqHdrCfg->stSMAP.au32NumSM ));
        memcpy(pstPqHdrCfg->stSMAP.au32PosSM ,  g_stToolHdrSmap.au32X_pos,  sizeof(pstPqHdrCfg->stSMAP.au32PosSM ));
        memcpy(pstPqHdrCfg->stSMAP.pu32LUTSM,   g_stToolHdrSmap.au32Y_LUT,  sizeof(pstPqHdrCfg->stSMAP.pu32LUTSM));
    }

    return HI_SUCCESS;
}

static HI_S32 pq_hal_SetR2YMatrix(HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    /* RGB2YUV */
    pstPqHdrCfg->stR2Y.u16ScaleR2Y = u16ScaleR2Y;

    switch (enOutCS)
    {
        case HI_DRV_CS_BT2020_YUV_LIMITED:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YL_2020NCL, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YL,  sizeof(pstPqHdrCfg->stR2Y.as16DcInR2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YL, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YL_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YL_UV;
            break;
        case HI_DRV_CS_BT2020_YUV_FULL:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YF_2020NCL, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YF,  sizeof(pstPqHdrCfg->stR2Y.as16DcInR2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YF, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YF_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YF_UV;
            break;
        case HI_DRV_CS_BT709_YUV_LIMITED:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YL_709, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YL,  sizeof(pstPqHdrCfg->stR2Y.as16DcInR2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YL, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YL_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YL_UV;
            break;
        case HI_DRV_CS_BT709_YUV_FULL:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YF_709, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YF,  sizeof(pstPqHdrCfg->stR2Y.as16DcInR2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YF, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YF_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YF_UV;
            break;
        case HI_DRV_CS_BT601_YUV_LIMITED:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YL_601, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YL,  sizeof(pstPqHdrCfg->stR2Y.as16DcInR2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YL, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YL_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YL_UV;
            break;
        case HI_DRV_CS_BT601_YUV_FULL:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YF_601, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YF,  sizeof(pstPqHdrCfg->stR2Y.as16DcInR2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YF, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YF_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YF_UV;
            break;
        case HI_DRV_CS_BT2020_RGB_FULL: /*R2R */
        case HI_DRV_CS_BT709_RGB_FULL: /*R2R */
        case HI_DRV_CS_BT601_RGB_FULL: /*R2R */
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2RF,   sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2RF,  sizeof(pstPqHdrCfg->stR2Y.as16DcInR2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2RF, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2RF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2RF_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2RF_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2RF_UV;
            break;
        default:
            memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   as16M33RF2YL_709, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcInR2Y,  as16DcInRF2YL,  sizeof(pstPqHdrCfg->stR2Y.as16DcInR2Y));
            memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, as16DcOutRF2YL, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_Y  = u16ClipMinRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_Y  = u16ClipMaxRF2YL_Y;
            pstPqHdrCfg->stR2Y.u16ClipMinR2Y_UV = u16ClipMinRF2YL_UV;
            pstPqHdrCfg->stR2Y.u16ClipMaxR2Y_UV = u16ClipMaxRF2YL_UV;
            break;
    }

    return HI_SUCCESS;
}

static HI_S32 pq_hal_AdjustHDRTmCurve(HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    HI_S8 i;
    pstPqHdrCfg->stTMAP.u16ScaleLumaCal = u16TmScaleLumaCal;
    if (g_u32BrightCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR] < 50)
    {
        for (i = 0; i < 64; i++)
        {
            pstPqHdrCfg->stTMAP.pu32LUTTM[i] = (g_u32BrightCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR] * pstPqHdrCfg->stTMAP.pu32LUTTM[i]
                                                + (50 - g_u32BrightCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR]) * au32TMLut_HDR2SDR_b0[i]) / 50;
        }
    }
    else if (g_u32BrightCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR] > 50)
    {
        for (i = 0; i < 64; i++)
        {
            pstPqHdrCfg->stTMAP.pu32LUTTM[i] = ((100 - g_u32BrightCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR]) * pstPqHdrCfg->stTMAP.pu32LUTTM[i]
                                                + (g_u32BrightCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR] - 50) * au32TMLut_HDR2SDR_b100[i]) / 50;
        }
    }

    if (g_u32DarkCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR] < 50)
    {
        for (i = 0; i < 64; i++)
        {
            pstPqHdrCfg->stTMAP.pu32LUTTM[i] = (g_u32DarkCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR] * pstPqHdrCfg->stTMAP.pu32LUTTM[i]
                                                + (50 - g_u32DarkCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR]) * au32TMLut_HDR2SDR_d0[i]) / 50;
        }
    }
    else if (g_u32DarkCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR] > 50)
    {
        for (i = 0; i < 64; i++)
        {
            pstPqHdrCfg->stTMAP.pu32LUTTM[i] = ((100 - g_u32DarkCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR]) * pstPqHdrCfg->stTMAP.pu32LUTTM[i]
                                                + (g_u32DarkCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR] - 50) * au32TMLut_HDR2SDR_d100[i]) / 50;
        }
    }
    pqprint(PQ_PRN_HDR, "Curve_para:M:%d,AccD:%d,AccB:%d,D:%d,B:%d\n", \
            g_u32HdrMode[HI_PQ_HDR_MODE_HDR10_TO_SDR],
            g_u32ACCDarkStr[HI_PQ_HDR_MODE_HDR10_TO_SDR],
            g_u32ACCBrightStr[HI_PQ_HDR_MODE_HDR10_TO_SDR],
            g_u32DarkCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR],
            g_u32BrightCvStr[HI_PQ_HDR_MODE_HDR10_TO_SDR]);

    return HI_SUCCESS;
}


static HI_S32 pq_hal_GetHDR2HDRCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    /* WCG */
    if (enInCS != enOutCS)
    {
        pstPqHdrCfg->bY2REn         = HI_TRUE;
        pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
        pstPqHdrCfg->bV1Y2REn       = HI_TRUE; /*96add */
        pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
        pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
        pstPqHdrCfg->bDegammaEn     = HI_TRUE;
        pstPqHdrCfg->bTMapEn        = HI_FALSE;
        pstPqHdrCfg->bGMapEn        = HI_TRUE;
        pstPqHdrCfg->bGammaEn       = HI_TRUE;
        pstPqHdrCfg->bDitherEn      = HI_FALSE;
        pstPqHdrCfg->bR2YEn         = HI_TRUE;
        pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;  /*96add */
        pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

        pstPqHdrCfg->bGMapPosSel    = HI_TRUE;   /* true : gmapping after tmap; false : gmapping before tmap*/
        pstPqHdrCfg->bDitherMode    = HI_FALSE;
    }
    else
    {
        pstPqHdrCfg->bY2REn         = HI_FALSE;
        pstPqHdrCfg->bV0Y2REn       = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1Y2REn       = HI_FALSE; /*96add */
        pstPqHdrCfg->vdm_v0_gamma_en = HI_FALSE; /*96add */
        pstPqHdrCfg->bDegammaEn     = HI_FALSE;
        pstPqHdrCfg->bTMapEn        = HI_FALSE;
        pstPqHdrCfg->bGMapEn        = HI_FALSE;
        pstPqHdrCfg->bGammaEn       = HI_FALSE;
        pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
        pstPqHdrCfg->bDitherEn      = HI_FALSE;
        pstPqHdrCfg->bR2YEn         = HI_FALSE;
        pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;  /*96add */
        pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

        pstPqHdrCfg->bGMapPosSel    = HI_FALSE;   /* true : gmapping after tmap; false : gmapping before tmap*/
        pstPqHdrCfg->bDitherMode    = HI_FALSE;
    }

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step, sizeof(pstPqHdrCfg->stDeGmm.au32Step));
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos,  au32DeGmm_pos,  sizeof(pstPqHdrCfg->stDeGmm.au32Pos));
    memcpy(pstPqHdrCfg->stDeGmm.au32Num,  au32DeGmm_num,  sizeof(pstPqHdrCfg->stDeGmm.au32Num));
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT,  au32DeGmmLut_PQ, sizeof(pstPqHdrCfg->stDeGmm.pu32LUT));

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmStep, sizeof(pstPqHdrCfg->stGmm.au32Step));
    memcpy(pstPqHdrCfg->stGmm.au32Pos,  au32GmmPos,  sizeof(pstPqHdrCfg->stGmm.au32Pos));
    memcpy(pstPqHdrCfg->stGmm.au32Num,  au32GmmNum,  sizeof(pstPqHdrCfg->stGmm.au32Num));
    memcpy(pstPqHdrCfg->stGmm.pu32LUT,  au32GmmLut_PQ10000, sizeof(pstPqHdrCfg->stGmm.pu32LUT));

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(g_as16DcOutR2Y));
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetHDR2SDRCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
    pstPqHdrCfg->bV1Y2REn       = HI_FALSE;  /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE;  /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_TRUE;   /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bGMapPosSel    = HI_TRUE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step, sizeof(pstPqHdrCfg->stDeGmm.au32Step));
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos,  au32DeGmm_pos,  sizeof(pstPqHdrCfg->stDeGmm.au32Pos));
    memcpy(pstPqHdrCfg->stDeGmm.au32Num,  au32DeGmm_num,  sizeof(pstPqHdrCfg->stDeGmm.au32Num));
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT,  au32DeGmmLut_PQ, sizeof(pstPqHdrCfg->stDeGmm.pu32LUT));

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    pq_hal_AdjustHDRTmCurve(pstPqHdrCfg);

    /* ToneMapping Tmap  adjust with acc histgram*/
    PQ_HAL_CalcHdrTmapACCHistGram(pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmStep, sizeof(pstPqHdrCfg->stGmm.au32Step));
    memcpy(pstPqHdrCfg->stGmm.au32Pos,  au32GmmPos,  sizeof(pstPqHdrCfg->stGmm.au32Pos));
    memcpy(pstPqHdrCfg->stGmm.au32Num,  au32GmmNum,  sizeof(pstPqHdrCfg->stGmm.au32Num));
    memcpy(pstPqHdrCfg->stGmm.pu32LUT,  au32GmmLut_22,  sizeof(pstPqHdrCfg->stGmm.pu32LUT));

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);

    /* Hdr Offset Adjust */
    PQ_hal_HdrOffsetCalCSCCoefRGBtoYCbCr(HI_PQ_HDR_MODE_HDR10_TO_SDR,
                                         g_u32HdrOffsetContrast[HI_PQ_HDR_MODE_HDR10_TO_SDR],
                                         g_u32HdrOffsetSatu[HI_PQ_HDR_MODE_HDR10_TO_SDR],
                                         g_u32HdrOffsetHue[HI_PQ_HDR_MODE_HDR10_TO_SDR],
                                         g_u32HdrOffsetRed[HI_PQ_HDR_MODE_HDR10_TO_SDR],
                                         g_u32HdrOffsetGreen[HI_PQ_HDR_MODE_HDR10_TO_SDR],
                                         g_u32HdrOffsetBlue[HI_PQ_HDR_MODE_HDR10_TO_SDR],
                                         pstPqHdrCfg->stR2Y.as16M33R2Y,
                                         g_aDstHdrOffsetCSCTable[HI_PQ_HDR_MODE_HDR10_TO_SDR]);

    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstHdrOffsetCSCTable[HI_PQ_HDR_MODE_HDR10_TO_SDR], sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));

    memcpy(g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_HDR10_TO_SDR], pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_HDR10_TO_SDR]));

    g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_HDR10_TO_SDR][0] = g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_HDR10_TO_SDR][0] +
            (g_u32HdrOffsetBright[HI_PQ_HDR_MODE_HDR10_TO_SDR] - 128) * 4;

    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);

    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));

    g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_HDR10_TO_SDR][0] = g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_HDR10_TO_SDR][0] + (g_u32Bright - 128) * 4;

    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_HDR10_TO_SDR], sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetHDR2HLGCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
    pstPqHdrCfg->bV1Y2REn       = HI_FALSE;  /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE;  /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_TRUE;   /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bGMapPosSel    = HI_TRUE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step, sizeof(pstPqHdrCfg->stDeGmm.au32Step));
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos,  au32DeGmm_pos,  sizeof(pstPqHdrCfg->stDeGmm.au32Pos));
    memcpy(pstPqHdrCfg->stDeGmm.au32Num,  au32DeGmm_num,  sizeof(pstPqHdrCfg->stDeGmm.au32Num));
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT,  au32DeGmmLut_PQ, sizeof(pstPqHdrCfg->stDeGmm.pu32LUT));

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmStep, sizeof(pstPqHdrCfg->stGmm.au32Step));
    memcpy(pstPqHdrCfg->stGmm.au32Pos,  au32GmmPos,  sizeof(pstPqHdrCfg->stGmm.au32Pos));
    memcpy(pstPqHdrCfg->stGmm.au32Num,  au32GmmNum,  sizeof(pstPqHdrCfg->stGmm.au32Num));
    memcpy(pstPqHdrCfg->stGmm.pu32LUT,  au32GmmLut_HLG,  sizeof(pstPqHdrCfg->stGmm.pu32LUT));

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(g_as16DcOutR2Y));
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));

    return HI_SUCCESS;
}

HI_S32 pq_hal_GetHLG2SDRCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */

    pstPqHdrCfg->bV1Y2REn       = HI_FALSE; /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_TRUE;  /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bGMapPosSel    = HI_TRUE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step,   sizeof(pstPqHdrCfg->stDeGmm.au32Step));
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos , au32DeGmm_pos,    sizeof(pstPqHdrCfg->stDeGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stDeGmm.au32Num , au32DeGmm_num,    sizeof(pstPqHdrCfg->stDeGmm.au32Num ));
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT , au32DeGmmLut_HLG, sizeof(pstPqHdrCfg->stDeGmm.pu32LUT ));

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmStep,  sizeof(pstPqHdrCfg->stGmm.au32Step));
    memcpy(pstPqHdrCfg->stGmm.au32Pos ,  au32GmmPos,  sizeof(pstPqHdrCfg->stGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stGmm.au32Num ,  au32GmmNum,  sizeof(pstPqHdrCfg->stGmm.au32Num ));
    memcpy(pstPqHdrCfg->stGmm.pu32LUT ,  au32GmmLut_22,     sizeof(pstPqHdrCfg->stGmm.pu32LUT ));
    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(g_as16DcOutR2Y));
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetHLG2HDRCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
    pstPqHdrCfg->bV1Y2REn       = HI_FALSE;  /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE;  /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;   /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

    pstPqHdrCfg->bGMapPosSel    = HI_TRUE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step, au32DeGmm_step,   sizeof(pstPqHdrCfg->stDeGmm.au32Step));
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos ,  au32DeGmm_pos,   sizeof(pstPqHdrCfg->stDeGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stDeGmm.au32Num ,  au32DeGmm_num,   sizeof(pstPqHdrCfg->stDeGmm.au32Num ));
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT ,  au32DeGmmLut_HLG, sizeof(pstPqHdrCfg->stDeGmm.pu32LUT ));

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmStep, sizeof(pstPqHdrCfg->stGmm.au32Step));
    memcpy(pstPqHdrCfg->stGmm.au32Pos ,  au32GmmPos, sizeof(pstPqHdrCfg->stGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stGmm.au32Num ,  au32GmmNum, sizeof(pstPqHdrCfg->stGmm.au32Num ));
    memcpy(pstPqHdrCfg->stGmm.pu32LUT ,  au32GmmLut_PQ1250, sizeof(pstPqHdrCfg->stGmm.pu32LUT ));

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(g_as16DcOutR2Y));
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetHLG2HLGCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    /* WCG */
    if (enInCS != enOutCS)
    {
        pstPqHdrCfg->bY2REn         = HI_TRUE;
        pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
        pstPqHdrCfg->bV1Y2REn       = HI_TRUE; /*96add */
        pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
        pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
        pstPqHdrCfg->bDegammaEn     = HI_TRUE;
        pstPqHdrCfg->bTMapEn        = HI_FALSE;
        pstPqHdrCfg->bGMapEn        = HI_TRUE;
        pstPqHdrCfg->bGammaEn       = HI_TRUE;
        pstPqHdrCfg->bDitherEn      = HI_TRUE;
        pstPqHdrCfg->bR2YEn         = HI_TRUE;
        pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;  /*96add */
        pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

        pstPqHdrCfg->bGMapPosSel    = HI_TRUE;   /* true : gmapping after tmap; false : gmapping before tmap*/
        pstPqHdrCfg->bDitherMode    = HI_FALSE;
    }
    else
    {
        pstPqHdrCfg->bY2REn         = HI_FALSE;
        pstPqHdrCfg->bV0Y2REn       = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1Y2REn       = HI_FALSE; /*96add */
        pstPqHdrCfg->vdm_v0_gamma_en = HI_FALSE; /*96add */
        pstPqHdrCfg->bDegammaEn     = HI_FALSE;
        pstPqHdrCfg->bTMapEn        = HI_FALSE;
        pstPqHdrCfg->bGMapEn        = HI_FALSE;
        pstPqHdrCfg->bGammaEn       = HI_FALSE;
        pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
        pstPqHdrCfg->bDitherEn      = HI_FALSE;
        pstPqHdrCfg->bR2YEn         = HI_FALSE;
        pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;  /*96add */
        pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

        pstPqHdrCfg->bGMapPosSel    = HI_FALSE;   /* true : gmapping after tmap; false : gmapping before tmap*/
        pstPqHdrCfg->bDitherMode    = HI_FALSE;
    }

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step,  au32DeGmm_step,  sizeof(pstPqHdrCfg->stDeGmm.au32Step));
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos ,  au32DeGmm_pos,   sizeof(pstPqHdrCfg->stDeGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stDeGmm.au32Num ,  au32DeGmm_num,   sizeof(pstPqHdrCfg->stDeGmm.au32Num ));
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT ,  au32DeGmmLut_HLG, sizeof(pstPqHdrCfg->stDeGmm.pu32LUT ));

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step, au32GmmStep, sizeof(pstPqHdrCfg->stGmm.au32Step));
    memcpy(pstPqHdrCfg->stGmm.au32Pos , au32GmmPos,  sizeof(pstPqHdrCfg->stGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stGmm.au32Num , au32GmmNum,  sizeof(pstPqHdrCfg->stGmm.au32Num ));
    memcpy(pstPqHdrCfg->stGmm.pu32LUT , au32GmmLut_HLG,    sizeof(pstPqHdrCfg->stGmm.pu32LUT ));

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(g_as16DcOutR2Y));
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));

    return HI_SUCCESS;
}


static HI_S32 pq_hal_GetSLF2SDRCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
    pstPqHdrCfg->bV1Y2REn       = HI_FALSE;  /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE;  /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_TRUE;   /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

    pstPqHdrCfg->bGMapPosSel    = HI_TRUE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step,  au32DeGmm_step,  sizeof(pstPqHdrCfg->stDeGmm.au32Step));
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos ,  au32DeGmm_pos,   sizeof(pstPqHdrCfg->stDeGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stDeGmm.au32Num ,  au32DeGmm_num,   sizeof(pstPqHdrCfg->stDeGmm.au32Num ));
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT ,  au32DeGmmLut_22, sizeof(pstPqHdrCfg->stDeGmm.pu32LUT ));
    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step,  au32GmmStep, sizeof(pstPqHdrCfg->stGmm.au32Step));
    memcpy(pstPqHdrCfg->stGmm.au32Pos ,  au32GmmPos,  sizeof(pstPqHdrCfg->stGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stGmm.au32Num ,  au32GmmNum,  sizeof(pstPqHdrCfg->stGmm.au32Num ));
    memcpy(pstPqHdrCfg->stGmm.pu32LUT ,  au32GmmLut_22,     sizeof(pstPqHdrCfg->stGmm.pu32LUT ));

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(g_as16DcOutR2Y));
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetSLF2HDRCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
    pstPqHdrCfg->bV1Y2REn       = HI_FALSE;  /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE;  /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;   /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

    pstPqHdrCfg->bGMapPosSel    = HI_TRUE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step,  au32DeGmm_step,   sizeof(pstPqHdrCfg->stDeGmm.au32Step));
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos ,  au32DeGmm_pos,    sizeof(pstPqHdrCfg->stDeGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stDeGmm.au32Num ,  au32DeGmm_num,    sizeof(pstPqHdrCfg->stDeGmm.au32Num ));
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT ,  au32DeGmmLut_SLF, sizeof(pstPqHdrCfg->stDeGmm.pu32LUT ));

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step,  au32GmmStep,   sizeof(pstPqHdrCfg->stGmm.au32Step));
    memcpy(pstPqHdrCfg->stGmm.au32Pos ,  au32GmmPos,    sizeof(pstPqHdrCfg->stGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stGmm.au32Num ,  au32GmmNum,    sizeof(pstPqHdrCfg->stGmm.au32Num ));
    memcpy(pstPqHdrCfg->stGmm.pu32LUT ,  au32GmmLut_PQ10000,  sizeof(pstPqHdrCfg->stGmm.pu32LUT ));

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(g_as16DcOutR2Y));
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));

    return HI_SUCCESS;
}


static HI_S32 pq_hal_GetSDR2HDRCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
    pstPqHdrCfg->bV1Y2REn       = HI_FALSE;  /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE;  /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_TRUE;   /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

    pstPqHdrCfg->bGMapPosSel    = HI_FALSE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step,  au32DeGmm_step,  sizeof(pstPqHdrCfg->stDeGmm.au32Step));
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos ,  au32DeGmm_pos,   sizeof(pstPqHdrCfg->stDeGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stDeGmm.au32Num ,  au32DeGmm_num,   sizeof(pstPqHdrCfg->stDeGmm.au32Num ));
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT ,  au32DeGmmLut_24, sizeof(pstPqHdrCfg->stDeGmm.pu32LUT ));

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step,  au32GmmStep, sizeof(pstPqHdrCfg->stGmm.au32Step));
    memcpy(pstPqHdrCfg->stGmm.au32Pos ,  au32GmmPos,  sizeof(pstPqHdrCfg->stGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stGmm.au32Num ,  au32GmmNum,  sizeof(pstPqHdrCfg->stGmm.au32Num ));
    memcpy(pstPqHdrCfg->stGmm.pu32LUT ,  au32GmmLut_PQ1000, sizeof(pstPqHdrCfg->stGmm.pu32LUT ));

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);

    /* Hdr Offset Adjust */
    PQ_hal_HdrOffsetCalCSCCoefRGBtoYCbCr(HI_PQ_HDR_MODE_SDR_TO_HDR10,
                                         g_u32HdrOffsetContrast[HI_PQ_HDR_MODE_SDR_TO_HDR10],
                                         g_u32HdrOffsetSatu[HI_PQ_HDR_MODE_SDR_TO_HDR10],
                                         g_u32HdrOffsetHue[HI_PQ_HDR_MODE_SDR_TO_HDR10],
                                         g_u32HdrOffsetRed[HI_PQ_HDR_MODE_SDR_TO_HDR10],
                                         g_u32HdrOffsetGreen[HI_PQ_HDR_MODE_SDR_TO_HDR10],
                                         g_u32HdrOffsetBlue[HI_PQ_HDR_MODE_SDR_TO_HDR10],
                                         pstPqHdrCfg->stR2Y.as16M33R2Y,
                                         g_aDstHdrOffsetCSCTable[HI_PQ_HDR_MODE_SDR_TO_HDR10]);

    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstHdrOffsetCSCTable[HI_PQ_HDR_MODE_SDR_TO_HDR10], sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));

    memcpy(g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_SDR_TO_HDR10], pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_SDR_TO_HDR10]));

    g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_SDR_TO_HDR10][0] = g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_SDR_TO_HDR10][0] +
            (g_u32HdrOffsetBright[HI_PQ_HDR_MODE_SDR_TO_HDR10] - 128) * 4;

    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);

    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));

    g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_SDR_TO_HDR10][0] = g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_SDR_TO_HDR10][0] + (g_u32Bright - 128) * 4;

    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16HdrOffsetDcOutR2Y[HI_PQ_HDR_MODE_SDR_TO_HDR10], sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetSDR2HLGCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    pstPqHdrCfg->bY2REn         = HI_TRUE;
    pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
    pstPqHdrCfg->bV1Y2REn       = HI_FALSE;  /*96add */
    pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
    pstPqHdrCfg->bDegammaEn     = HI_TRUE;
    pstPqHdrCfg->bTMapEn        = HI_TRUE;
    pstPqHdrCfg->bGMapEn        = HI_TRUE;
    pstPqHdrCfg->bGammaEn       = HI_TRUE;
    pstPqHdrCfg->bV1GammaEn     = HI_FALSE;  /*96add */
    pstPqHdrCfg->bDitherEn      = HI_TRUE;
    pstPqHdrCfg->bR2YEn         = HI_TRUE;
    pstPqHdrCfg->bChromaAdjEn   = HI_TRUE;   /*96add */
    pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
    pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

    pstPqHdrCfg->bGMapPosSel    = HI_FALSE;
    pstPqHdrCfg->bDitherMode    = HI_TRUE;

    /* YUV2RGB */
    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step,  au32DeGmm_step,  sizeof(pstPqHdrCfg->stDeGmm.au32Step));
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos ,  au32DeGmm_pos,   sizeof(pstPqHdrCfg->stDeGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stDeGmm.au32Num ,  au32DeGmm_num,   sizeof(pstPqHdrCfg->stDeGmm.au32Num ));
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT ,  au32DeGmmLut_24, sizeof(pstPqHdrCfg->stDeGmm.pu32LUT ));

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step,  au32GmmStep, sizeof(pstPqHdrCfg->stGmm.au32Step));
    memcpy(pstPqHdrCfg->stGmm.au32Pos ,  au32GmmPos,  sizeof(pstPqHdrCfg->stGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stGmm.au32Num ,  au32GmmNum,  sizeof(pstPqHdrCfg->stGmm.au32Num ));
    memcpy(pstPqHdrCfg->stGmm.pu32LUT ,  au32GmmLut_HLG, sizeof(pstPqHdrCfg->stGmm.pu32LUT ));

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(g_as16DcOutR2Y));
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetSDR2SDRCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    /* WCG */
    if (enInCS != enOutCS)
    {
        pstPqHdrCfg->bY2REn         = HI_TRUE;
        pstPqHdrCfg->bV0Y2REn       = HI_TRUE;  /*96add */
        pstPqHdrCfg->bV1Y2REn       = HI_TRUE; /*96add */
        pstPqHdrCfg->vdm_v0_gamma_en = HI_TRUE; /*96add */
        pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
        pstPqHdrCfg->bDegammaEn     = HI_TRUE;
        pstPqHdrCfg->bTMapEn        = HI_FALSE;
        pstPqHdrCfg->bGMapEn        = HI_TRUE;
        pstPqHdrCfg->bGammaEn       = HI_TRUE;
        pstPqHdrCfg->bDitherEn      = HI_TRUE;
        pstPqHdrCfg->bR2YEn         = HI_TRUE;
        pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;  /*96add */
        pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

        pstPqHdrCfg->bGMapPosSel    = HI_TRUE;   /* true : gmapping after tmap; false : gmapping before tmap*/
        pstPqHdrCfg->bDitherMode    = HI_TRUE;
    }
    else
    {
        pstPqHdrCfg->bY2REn         = HI_FALSE;
        pstPqHdrCfg->bV0Y2REn       = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1Y2REn       = HI_FALSE; /*96add */
        pstPqHdrCfg->vdm_v0_gamma_en = HI_FALSE; /*96add */
        pstPqHdrCfg->bDegammaEn     = HI_FALSE;
        pstPqHdrCfg->bTMapEn        = HI_FALSE;
        pstPqHdrCfg->bGMapEn        = HI_FALSE;
        pstPqHdrCfg->bGammaEn       = HI_FALSE;
        pstPqHdrCfg->bV1GammaEn     = HI_FALSE; /*96add */
        pstPqHdrCfg->bDitherEn      = HI_FALSE;
        pstPqHdrCfg->bR2YEn         = HI_FALSE;
        pstPqHdrCfg->bChromaAdjEn   = HI_FALSE;  /*96add */
        pstPqHdrCfg->bBT2020CL      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bR2YPipEn      = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV0CLEn        = HI_FALSE;  /*96add */
        pstPqHdrCfg->bV1CLEn        = HI_FALSE;  /*96add */

        pstPqHdrCfg->bGMapPosSel    = HI_FALSE;   /* true : gmapping after tmap; false : gmapping before tmap*/
        pstPqHdrCfg->bDitherMode    = HI_FALSE;
    }

    pq_hal_SetY2RMatrix(enInCS, enOutCS, pstPqHdrCfg);

    /* DeGamma */
    memcpy(pstPqHdrCfg->stDeGmm.au32Step,  au32DeGmm_step,  sizeof(pstPqHdrCfg->stDeGmm.au32Step));
    memcpy(pstPqHdrCfg->stDeGmm.au32Pos ,  au32DeGmm_pos,   sizeof(pstPqHdrCfg->stDeGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stDeGmm.au32Num ,  au32DeGmm_num,   sizeof(pstPqHdrCfg->stDeGmm.au32Num ));
    memcpy(pstPqHdrCfg->stDeGmm.pu32LUT ,  au32DeGmmLut_22, sizeof(pstPqHdrCfg->stDeGmm.pu32LUT ));

    /* ToneMapping Tmap */
    pq_hal_SetHDRTMap(enInCS, pstPqHdrCfg);

    /* ToneMapping Smap */
    pq_hal_SetHDRSMap(enInCS, pstPqHdrCfg);

    /* GamutMapping */
    pq_hal_SetGamutMappingPara(enInCS, enOutCS, pstPqHdrCfg);

    /*  Gamma */
    memcpy(pstPqHdrCfg->stGmm.au32Step,  au32GmmStep, sizeof(pstPqHdrCfg->stGmm.au32Step));
    memcpy(pstPqHdrCfg->stGmm.au32Pos ,  au32GmmPos,  sizeof(pstPqHdrCfg->stGmm.au32Pos ));
    memcpy(pstPqHdrCfg->stGmm.au32Num ,  au32GmmNum,  sizeof(pstPqHdrCfg->stGmm.au32Num ));
    memcpy(pstPqHdrCfg->stGmm.pu32LUT ,  au32GmmLut_22,     sizeof(pstPqHdrCfg->stGmm.pu32LUT ));

    /* RGB2YUV */
    pq_hal_SetR2YMatrix(enOutCS, pstPqHdrCfg);
    /* Hdr Normal Adjust */
    PQ_hal_CalCSCCoefRGBtoYCbCr(g_u32Contrast, g_u32Satu, g_u32Hue,
                                g_u32Red, g_u32Green, g_u32Blue, pstPqHdrCfg->stR2Y.as16M33R2Y, g_aDstCSCTable);
    memcpy(pstPqHdrCfg->stR2Y.as16M33R2Y,   g_aDstCSCTable, sizeof(pstPqHdrCfg->stR2Y.as16M33R2Y));

    memcpy(g_as16DcOutR2Y, pstPqHdrCfg->stR2Y.as16DcOutR2Y, sizeof(g_as16DcOutR2Y));
    g_as16DcOutR2Y[0] = g_as16DcOutR2Y[0] + (g_u32Bright - 128) * 4;
    memcpy(pstPqHdrCfg->stR2Y.as16DcOutR2Y, g_as16DcOutR2Y, sizeof(pstPqHdrCfg->stR2Y.as16DcOutR2Y));

    return HI_SUCCESS;
}

static HI_S32 pq_hal_GetSLF2HLGCfg(HI_DRV_COLOR_SPACE_E enInCS, HI_DRV_COLOR_SPACE_E enOutCS, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    HI_UNUSED(enInCS);
    HI_UNUSED(enOutCS);

    return HI_FAILURE;
}

PF_PQ_Hal_GetHdrPathCfg pfPqHalGetHdrPathCfg[HI_PQ_HDR_MODE_BUTT] =
{
    pq_hal_GetHDR2SDRCfg,
    pq_hal_GetHDR2HDRCfg,
    pq_hal_GetHDR2HLGCfg,

    pq_hal_GetHLG2SDRCfg,
    pq_hal_GetHLG2HDRCfg,
    pq_hal_GetHLG2HLGCfg,

    pq_hal_GetSLF2SDRCfg,
    pq_hal_GetSLF2HDRCfg,
    pq_hal_GetSLF2HLGCfg,

    pq_hal_GetSDR2SDRCfg,
    pq_hal_GetSDR2HDRCfg,
    pq_hal_GetSDR2HLGCfg,
};

HI_S32 PQ_HAL_GetHDRCfg(HI_PQ_XDR_FRAME_INFO *pstXdrFrameInfo, HI_PQ_HDR_CFG *pstPqHdrCfg)
{
    HI_S32 s32Ret = HI_SUCCESS;

    PQ_CHECK_NULL_PTR_RE_FAIL(pstXdrFrameInfo);
    PQ_CHECK_NULL_PTR_RE_FAIL(pstPqHdrCfg);
    PQ_CHECK_OVER_RANGE_RE_FAIL(pstXdrFrameInfo->enSrcFrameType, HI_DRV_VIDEO_FRAME_TYPE_BUTT);
    PQ_CHECK_OVER_RANGE_RE_FAIL(pstXdrFrameInfo->enDispType, HI_PQ_DISP_TYPE_BUTT);

    pg_stPqHdrCfg = pstPqHdrCfg;

    stDminfo.u32SrcMaxPQ = pstXdrFrameInfo->unHDRInfo.stHDR10Info.stMasteringInfo.u32MaxDisplayMasteringLuminance;
    stDminfo.u32SrcMinPQ = pstXdrFrameInfo->unHDRInfo.stHDR10Info.stMasteringInfo.u32MinDisplayMasteringLuminance;

    sg_enHDRMode = aenPqHalHdrPathMode[pstXdrFrameInfo->enSrcFrameType][pstXdrFrameInfo->enDispType];

    PQ_CHECK_OVER_RANGE_RE_FAIL(sg_enHDRMode, HI_PQ_HDR_MODE_BUTT);

    s32Ret  = pfPqHalGetHdrPathCfg[sg_enHDRMode](pstXdrFrameInfo->enInCS, pstXdrFrameInfo->enOutCS, pstPqHdrCfg);

    return s32Ret;
}

HI_S32 PQ_HAL_InitHDR(PQ_PARAM_S *pstPqParam, HI_BOOL bParaUseTableDefault)
{
    HI_U32 u32StepBinSum0 = 0;
    HI_U32 u32StepBinSum1 = 0;
    HI_U32 u32NumBinSum0  = 0;
    HI_U32 u32NumBinSum1  = 0;
    HI_U32 u32PosBinSum0  = 0;
    HI_U32 u32PosBinSum1  = 0;
    HI_U32 u32TmapBinSum0 = 0;
    HI_U32 u32TmapBinSum1 = 0;

    HI_U32 u32SmStepBinSum0 = 0;
    HI_U32 u32SmStepBinSum1 = 0;
    HI_U32 u32SmNumBinSum0  = 0;
    HI_U32 u32SmNumBinSum1  = 0;
    HI_U32 u32SmPosBinSum0  = 0;
    HI_U32 u32SmPosBinSum1  = 0;
    HI_U32 u32SmBinSum0 = 0;
    HI_U32 u32SmBinSum1 = 0;
    HI_U32 i = 0;

    sg_pstHdrBinPara = pstPqParam;

    PQ_CHECK_NULL_PTR_RE_FAIL(sg_pstHdrBinPara);

    /* step 1 : check pq bin data : all zero means no effective para from bin */
    /* check pq bin data */
    for (i = 0; i < 8; i++)
    {
        //Tmap
        u32StepBinSum0 += sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Step[PQ_TOOL_HDR2SDR][i];
        u32StepBinSum1 += sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Step[PQ_TOOL_SDR2HDR][i];
        u32NumBinSum0  += sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Num[PQ_TOOL_HDR2SDR][i];
        u32NumBinSum1  += sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Num[PQ_TOOL_SDR2HDR][i];
        u32PosBinSum0  += sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Pos[PQ_TOOL_HDR2SDR][i];
        u32PosBinSum1  += sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Pos[PQ_TOOL_SDR2HDR][i];
        u32TmapBinSum0 += sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Clut[PQ_TOOL_HDR2SDR][i];
        u32TmapBinSum1 += sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Clut[PQ_TOOL_SDR2HDR][i];
        //Smap
        u32SmStepBinSum0 += sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Step[PQ_TOOL_HDR2SDR][i];
        u32SmStepBinSum1 += sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Step[PQ_TOOL_SDR2HDR][i];
        u32SmNumBinSum0  += sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Num[PQ_TOOL_HDR2SDR][i];
        u32SmNumBinSum1  += sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Num[PQ_TOOL_SDR2HDR][i];
        u32SmPosBinSum0  += sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Pos[PQ_TOOL_HDR2SDR][i];
        u32SmPosBinSum1  += sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Pos[PQ_TOOL_SDR2HDR][i];
        u32SmBinSum0     += sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Clut[PQ_TOOL_HDR2SDR][i];
        u32SmBinSum1     += sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Clut[PQ_TOOL_SDR2HDR][i];
    }

    /* step 2 : para use from bin or code */
    /*
        1.use bin para : if bin para not all zero
        2.use code para : if bin para all zero or no bin exist
    */

    /* HDR2SDR : use bin para && bin step para not all 0 */
    /* Tmap step */
    if ((HI_TRUE != bParaUseTableDefault) && (u32StepBinSum0 != 0))
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Step[PQ_TOOL_HDR2SDR], sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Step[PQ_TOOL_HDR2SDR], \
               sizeof(sg_stHdrTmClutBinOrCode.au32Step[PQ_TOOL_HDR2SDR]));
    }
    else
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Step[PQ_TOOL_HDR2SDR], au32TMapStep, sizeof(sg_stHdrTmClutBinOrCode.au32Step[PQ_TOOL_HDR2SDR]));
    }

    /* Tmap num */
    if ((HI_TRUE != bParaUseTableDefault) && (u32NumBinSum0 != 0))
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Num[PQ_TOOL_HDR2SDR], sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Num[PQ_TOOL_HDR2SDR], \
               sizeof(sg_stHdrTmClutBinOrCode.au32Num[PQ_TOOL_HDR2SDR]));
    }
    else
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Num[PQ_TOOL_HDR2SDR], au32TMapNum, sizeof(sg_stHdrTmClutBinOrCode.au32Num[PQ_TOOL_HDR2SDR]));
    }

    /* Tmap pos */
    if ((HI_TRUE != bParaUseTableDefault) && (u32PosBinSum0 != 0))
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Pos[PQ_TOOL_HDR2SDR], sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Pos[PQ_TOOL_HDR2SDR], \
               sizeof(sg_stHdrTmClutBinOrCode.au32Pos[PQ_TOOL_HDR2SDR]));
    }
    else
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Pos[PQ_TOOL_HDR2SDR], au32TMapPos, sizeof(sg_stHdrTmClutBinOrCode.au32Pos[PQ_TOOL_HDR2SDR]));
    }

    /* tmap */
    if ((HI_TRUE != bParaUseTableDefault) && (u32TmapBinSum0 != 0))
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Clut[PQ_TOOL_HDR2SDR], sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Clut[PQ_TOOL_HDR2SDR], \
               sizeof(sg_stHdrTmClutBinOrCode.au32Clut[PQ_TOOL_HDR2SDR]));
    }
    else
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Clut[PQ_TOOL_HDR2SDR], au32TMLut_HDR2SDR_Vivid, sizeof(sg_stHdrTmClutBinOrCode.au32Clut[PQ_TOOL_HDR2SDR]));
    }

    /* HDR2SDR : use bin para && bin step para not all 0 */
    /* Smap step */
    if ((HI_TRUE != bParaUseTableDefault) && (u32SmStepBinSum0 != 0))
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Step[PQ_TOOL_HDR2SDR], sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Step[PQ_TOOL_HDR2SDR], \
               sizeof(sg_stHdrSmClutBinOrCode.au32Step[PQ_TOOL_HDR2SDR]));
    }
    else
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Step[PQ_TOOL_HDR2SDR], au32SMapStep, sizeof(sg_stHdrSmClutBinOrCode.au32Step[PQ_TOOL_HDR2SDR]));
    }

    /* Smap num */
    if ((HI_TRUE != bParaUseTableDefault) && (u32SmNumBinSum0 != 0))
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Num[PQ_TOOL_HDR2SDR], sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Num[PQ_TOOL_HDR2SDR], \
               sizeof(sg_stHdrSmClutBinOrCode.au32Num[PQ_TOOL_HDR2SDR]));
    }
    else
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Num[PQ_TOOL_HDR2SDR], au32SMapNum, sizeof(sg_stHdrSmClutBinOrCode.au32Num[PQ_TOOL_HDR2SDR]));
    }

    /* Smap pos */
    if ((HI_TRUE != bParaUseTableDefault) && (u32SmPosBinSum0 != 0))
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Pos[PQ_TOOL_HDR2SDR], sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Pos[PQ_TOOL_HDR2SDR], \
               sizeof(sg_stHdrSmClutBinOrCode.au32Pos[PQ_TOOL_HDR2SDR]));
    }
    else
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Pos[PQ_TOOL_HDR2SDR], au32SMapPos, sizeof(sg_stHdrSmClutBinOrCode.au32Pos[PQ_TOOL_HDR2SDR]));
    }

    /* Smap */
    if ((HI_TRUE != bParaUseTableDefault) && (u32SmBinSum0 != 0))
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Clut[PQ_TOOL_HDR2SDR], sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Clut[PQ_TOOL_HDR2SDR], \
               sizeof(sg_stHdrSmClutBinOrCode.au32Clut[PQ_TOOL_HDR2SDR]));
    }
    else
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Clut[PQ_TOOL_HDR2SDR], au32SMLut_HDR2SDR, sizeof(sg_stHdrSmClutBinOrCode.au32Clut[PQ_TOOL_HDR2SDR]));
    }

    /* SDR2HDR : use bin para && bin step para not all 0 */
    /* Tmap step */
    if ((HI_TRUE != bParaUseTableDefault) && (u32StepBinSum1 != 0))
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Step[PQ_TOOL_SDR2HDR], sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Step[PQ_TOOL_SDR2HDR], \
               sizeof(sg_stHdrTmClutBinOrCode.au32Step[PQ_TOOL_SDR2HDR]));
    }
    else
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Step[PQ_TOOL_SDR2HDR], au32TMapStep, sizeof(sg_stHdrTmClutBinOrCode.au32Step[PQ_TOOL_SDR2HDR]));
    }

    /* Tmap num */
    if ((HI_TRUE != bParaUseTableDefault) && (u32NumBinSum1 != 0))
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Num[PQ_TOOL_SDR2HDR], sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Num[PQ_TOOL_SDR2HDR], \
               sizeof(sg_stHdrTmClutBinOrCode.au32Num[PQ_TOOL_SDR2HDR]));
    }
    else
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Num[PQ_TOOL_SDR2HDR], au32TMapNum, sizeof(sg_stHdrTmClutBinOrCode.au32Num[PQ_TOOL_SDR2HDR]));
    }

    /* Tmap pos */
    if ((HI_TRUE != bParaUseTableDefault) && (u32PosBinSum1 != 0))
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Pos[PQ_TOOL_SDR2HDR], sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Pos[PQ_TOOL_SDR2HDR], \
               sizeof(sg_stHdrTmClutBinOrCode.au32Pos[PQ_TOOL_SDR2HDR]));
    }
    else
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Pos[PQ_TOOL_SDR2HDR], au32TMapPos, sizeof(sg_stHdrTmClutBinOrCode.au32Pos[PQ_TOOL_SDR2HDR]));
    }

    /* tmap */
    if ((HI_TRUE != bParaUseTableDefault) && (u32TmapBinSum1 != 0))
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Clut[PQ_TOOL_SDR2HDR], sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Clut[PQ_TOOL_SDR2HDR], \
               sizeof(sg_stHdrTmClutBinOrCode.au32Clut[PQ_TOOL_SDR2HDR]));
    }
    else
    {
        memcpy(sg_stHdrTmClutBinOrCode.au32Clut[PQ_TOOL_SDR2HDR], au32TMLut_SDR2HDR, sizeof(sg_stHdrTmClutBinOrCode.au32Clut[PQ_TOOL_SDR2HDR]));
    }

    /* SDR2HDR : use bin para && bin step para not all 0 */
    /* Smap step */
    if ((HI_TRUE != bParaUseTableDefault) && (u32SmStepBinSum1 != 0))
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Step[PQ_TOOL_SDR2HDR], sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Step[PQ_TOOL_SDR2HDR], \
               sizeof(sg_stHdrSmClutBinOrCode.au32Step[PQ_TOOL_SDR2HDR]));
    }
    else
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Step[PQ_TOOL_SDR2HDR], au32SMapStep, sizeof(sg_stHdrSmClutBinOrCode.au32Step[PQ_TOOL_SDR2HDR]));
    }

    /* Smap num */
    if ((HI_TRUE != bParaUseTableDefault) && (u32SmNumBinSum1 != 0))
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Num[PQ_TOOL_SDR2HDR], sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Num[PQ_TOOL_SDR2HDR], \
               sizeof(sg_stHdrSmClutBinOrCode.au32Num[PQ_TOOL_SDR2HDR]));
    }
    else
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Num[PQ_TOOL_SDR2HDR], au32SMapNum, sizeof(sg_stHdrSmClutBinOrCode.au32Num[PQ_TOOL_SDR2HDR]));
    }

    /* Smap pos */
    if ((HI_TRUE != bParaUseTableDefault) && (u32SmPosBinSum1 != 0))
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Pos[PQ_TOOL_SDR2HDR], sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Pos[PQ_TOOL_SDR2HDR], \
               sizeof(sg_stHdrSmClutBinOrCode.au32Pos[PQ_TOOL_SDR2HDR]));
    }
    else
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Pos[PQ_TOOL_SDR2HDR], au32SMapPos, sizeof(sg_stHdrSmClutBinOrCode.au32Pos[PQ_TOOL_SDR2HDR]));
    }

    /* Smap */
    if ((HI_TRUE != bParaUseTableDefault) && (u32SmBinSum1 != 0))
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Clut[PQ_TOOL_SDR2HDR], sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Clut[PQ_TOOL_SDR2HDR], \
               sizeof(sg_stHdrSmClutBinOrCode.au32Clut[PQ_TOOL_SDR2HDR]));
    }
    else
    {
        memcpy(sg_stHdrSmClutBinOrCode.au32Clut[PQ_TOOL_SDR2HDR], au32SMLut_SDR2HDR, sizeof(sg_stHdrSmClutBinOrCode.au32Clut[PQ_TOOL_SDR2HDR]));
    }

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_Tool_SetHDRParaMode(HI_PQ_HDR_PARA_MODE_S *pstMode)
{
    PQ_CHECK_NULL_PTR_RE_FAIL(pstMode);

    sg_u32ToolHdrTmMode = pstMode->u32HdrTmMode;
    sg_u32ToolHdrSmMode = pstMode->u32HdrSmMode;

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_Tool_GetHDRParaMode(HI_PQ_HDR_PARA_MODE_S *pstMode)
{
    PQ_CHECK_NULL_PTR_RE_FAIL(pstMode);

    pstMode->u32HdrTmMode = sg_u32ToolHdrTmMode;
    pstMode->u32HdrSmMode = sg_u32ToolHdrSmMode;

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_Tool_SetHdrTMap(HI_PQ_HDR_TMAP_S *pstHdrTmap)
{
    HI_U32 i;

    PQ_CHECK_NULL_PTR_RE_FAIL(pstHdrTmap);

    memcpy(&g_stToolHdrTmap, pstHdrTmap, sizeof(g_stToolHdrTmap));

    /* Tool Send Clut * 2^16 */
    for (i = 0; i <  64; i++)
    {
        g_stToolHdrTmap.au32Y_LUT[i] = HDR_CLIP3(0, 65535, g_stToolHdrTmap.au32Y_LUT[i] >> (16 - sg_au16ToolTmScale));
    }

    switch (sg_enHDRMode)
    {
        case HI_PQ_HDR_MODE_HDR10_TO_SDR:
            /* Tmap Clut First Para = 0 */
            g_stToolHdrTmap.au32Y_LUT[0] = 0;

            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Step[PQ_TOOL_HDR2SDR], g_stToolHdrTmap.au32X_step, sizeof(g_stToolHdrTmap.au32X_step));
            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Num[PQ_TOOL_HDR2SDR],  g_stToolHdrTmap.au32X_num,  sizeof(g_stToolHdrTmap.au32X_num));
            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Pos[PQ_TOOL_HDR2SDR],  g_stToolHdrTmap.au32X_pos,  sizeof(g_stToolHdrTmap.au32X_pos));

            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Clut[PQ_TOOL_HDR2SDR], g_stToolHdrTmap.au32Y_LUT,  sizeof(g_stToolHdrTmap.au32Y_LUT));
            break;
        case HI_PQ_HDR_MODE_SDR_TO_HDR10:
            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Step[PQ_TOOL_SDR2HDR], g_stToolHdrTmap.au32X_step, sizeof(g_stToolHdrTmap.au32X_step));
            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Num[PQ_TOOL_SDR2HDR],  g_stToolHdrTmap.au32X_num,  sizeof(g_stToolHdrTmap.au32X_num));
            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Pos[PQ_TOOL_SDR2HDR],  g_stToolHdrTmap.au32X_pos,  sizeof(g_stToolHdrTmap.au32X_pos));

            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrTmCoef.au32Clut[PQ_TOOL_SDR2HDR], g_stToolHdrTmap.au32Y_LUT, sizeof(g_stToolHdrTmap.au32Y_LUT));
            break;
        default:
            HI_ERR_PQ("PQ Tool Only Support Hdr2Sdr & Sdr2Hdr Now \n");
            break;
    }

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_Tool_GetHdrTMap(HI_PQ_HDR_TMAP_S *pstHdrTmap)
{
    HI_U32 i;

    PQ_CHECK_NULL_PTR_RE_FAIL(pstHdrTmap);

    memcpy(pstHdrTmap, &g_stToolHdrTmap, sizeof(g_stToolHdrTmap));
    /* Tool Recieve Clut * 2^16 */
    for (i = 0; i <  64; i++)
    {
        pstHdrTmap->au32Y_LUT[i] = pstHdrTmap->au32Y_LUT[i] << (16 - sg_au16ToolTmScale);
    }

    return HI_SUCCESS;
}

HI_S32 PQ_HAL_Tool_SetHdrSMap(HI_PQ_HDR_SMAP_S *pstHdrSmap)
{
    HI_U32 i;
    PQ_CHECK_NULL_PTR_RE_FAIL(pstHdrSmap);

    memcpy(&g_stToolHdrSmap, pstHdrSmap, sizeof(g_stToolHdrSmap));
    for (i = 0; i <  64; i++)
    {
        g_stToolHdrSmap.au32Y_LUT[i] = HDR_CLIP3(0, 65535, pstHdrSmap->au32Y_LUT[i] >> (16 - sg_au16ToolSmScale));
    }

    switch (sg_enHDRMode)
    {
        case HI_PQ_HDR_MODE_HDR10_TO_SDR:
            /* Tmap Clut First Para = 0 */
            //g_stToolHdrSmap.au32Y_LUT[0] = 0;

            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Step[PQ_TOOL_HDR2SDR], g_stToolHdrSmap.au32X_step, sizeof(g_stToolHdrSmap.au32X_step));
            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Num[PQ_TOOL_HDR2SDR],  g_stToolHdrSmap.au32X_num,  sizeof(g_stToolHdrSmap.au32X_num));
            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Pos[PQ_TOOL_HDR2SDR],  g_stToolHdrSmap.au32X_pos,  sizeof(g_stToolHdrSmap.au32X_pos));

            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Clut[PQ_TOOL_HDR2SDR], g_stToolHdrSmap.au32Y_LUT,  sizeof(g_stToolHdrSmap.au32Y_LUT));
            break;
        case HI_PQ_HDR_MODE_SDR_TO_HDR10:
            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Step[PQ_TOOL_SDR2HDR], g_stToolHdrSmap.au32X_step, sizeof(g_stToolHdrSmap.au32X_step));
            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Num[PQ_TOOL_SDR2HDR],  g_stToolHdrSmap.au32X_num,  sizeof(g_stToolHdrSmap.au32X_num));
            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Pos[PQ_TOOL_SDR2HDR],  g_stToolHdrSmap.au32X_pos,  sizeof(g_stToolHdrSmap.au32X_pos));

            memcpy(sg_pstHdrBinPara->stPQCoef.stHdrSmCoef.au32Clut[PQ_TOOL_SDR2HDR], g_stToolHdrSmap.au32Y_LUT, sizeof(g_stToolHdrSmap.au32Y_LUT));
            break;
        default:
            HI_ERR_PQ("PQ Tool HdrSmap Only Support Hdr2Sdr & Sdr2Hdr Now \n");
            break;
    }
    return HI_SUCCESS;
}

HI_S32 PQ_HAL_Tool_GetHdrSMap(HI_PQ_HDR_SMAP_S *pstHdrSmap)
{
    HI_U32 i;
    PQ_CHECK_NULL_PTR_RE_FAIL(pstHdrSmap);

    memcpy(pstHdrSmap, &g_stToolHdrSmap, sizeof(g_stToolHdrSmap));

    /* Tool Recieve Clut * 2^16 */
    for (i = 0; i <  64; i++)
    {
        pstHdrSmap->au32Y_LUT[i] = g_stToolHdrSmap.au32Y_LUT[i] << (16 - sg_au16ToolSmScale);
    }

    return HI_SUCCESS;
}

